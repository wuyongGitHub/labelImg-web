# canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·
AIæ—¶ä»£ï¼Œéœ€è¦è¿›è¡Œæ•°æ®é›†çš„æ ‡æ³¨ï¼Œå¤šè¾¹å½¢æ ‡æ³¨ï¼ŒçŸ©å½¢æ ‡æ³¨ï¼Œå¤åˆ¶ç²˜è´´ï¼Œä¸Šä¸€å¼ ä¸‹ä¸€å¼ ï¼Œä¸»è¦æŠ€æœ¯æ ˆvue3+fabric.jså®ç°ç½‘é¡µç‰ˆæœ¬LabelImgæ ‡æ³¨åŠŸèƒ½ã€‚canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘
# ç›®å½•
- å‰è¨€
- ä¸»ä½“åŠŸèƒ½
- æ•ˆæœé¢„è§ˆ
- å®ç°æ­¥éª¤
- ç¬¬ä¸€æ­¥ã€å¸ƒå±€å®ç°
- ç¬¬äºŒæ­¥ã€ä¸‹è½½å¹¶å¼•å…¥fabric.jså¯¹è±¡åŠåŠŸèƒ½æ–¹æ³•
- ç¬¬ä¸‰æ­¥ã€åˆå§‹åŒ–ç”»å¸ƒ
- ç¬¬å››æ­¥ã€æ ‡æ³¨å›¾ç‰‡åˆå§‹åŒ–
- ç¬¬äº”æ­¥ã€è®¾ç½®ç”»å¸ƒåŠå…¶ä»–äº‹ä»¶ç›‘å¬å™¨
- ç¬¬å…­æ­¥ã€ çŸ©å½¢æ ‡æ³¨å®ç°
- ç¬¬ä¸ƒæ­¥ã€å¤šè¾¹å½¢æ ‡æ³¨å®ç°
- ç¬¬å…«æ­¥ã€åæ ‡è½¬æ¢ç³»ç»Ÿ
- ç¬¬ä¹æ­¥ã€æ ‡ç­¾ç®¡ç†
- ç¬¬åæ­¥ã€åå­—è¾…åŠ©çº¿åˆ›å»º
- ç¬¬åä¸€æ­¥ã€è‡ªå®šä¹‰æ§åˆ¶ç‚¹
- ç¬¬åäºŒæ­¥ã€åŸºäºæ ‡ç­¾æ–‡æœ¬ç”Ÿæˆå›ºå®šé¢œè‰²
- ç¬¬åä¸‰æ­¥ã€è¿›è¡ŒçŸ©å½¢çš„å›æ˜¾ç»˜åˆ¶
- ç¬¬åå››æ­¥ã€çŸ©å½¢åŠå¤šè¾¹å½¢ç»˜åˆ¶ç»“æŸlabelå¼¹çª—
- ç¬¬åäº”æ­¥ã€æ ¹æ®æ•°æ®æºå›æ˜¾å¤šè¾¹å½¢
- ç¬¬åå…­æ­¥ã€å¯¼å‡ºæ•°æ®æ ¼å¼åŠå…¶æ•°æ®
- å®Œç»“~
- ä¼˜åŒ–è¿›è¡Œä¸­~ å…³æ³¨æˆ‘ä¸å®šæ—¶è¿›è¡Œä»£ç ä¼˜åŒ–ä¸åŠŸèƒ½æ·»åŠ 
- ä¼˜åŒ–ä¸€ã€æ·»åŠ æ ‡æ³¨çš„å¤åˆ¶ç²˜è´´åŠŸèƒ½
- ä¼˜åŒ–äºŒã€æ·»åŠ ä¸è§„åˆ™å¤šè¾¹å½¢è§„åˆ™å¤„ç†
- ä¼˜åŒ–ä¸‰ã€å¤šè¾¹å½¢åˆ›å»ºäº¤äº’ä¼˜åŒ–ã€é˜²å‘†å¤„ç†ã€‘
- ä¼˜åŒ–å››ã€æ·»åŠ æ ‡æ³¨ç»“æœå¯¼å‡ºå›¾ç‰‡åŠŸèƒ½
- ä¼˜åŒ–äº”ã€åˆ›å»ºå¤šè¾¹å½¢æ–¹å¼ä¼˜åŒ–
- ä¼˜åŒ–å…­ã€åˆ›å»ºæ ‡æ³¨æ¡†çš„æ ‡ç­¾æ–¹å¼ä¼˜åŒ–
- ä¼˜åŒ–ä¸ƒã€è§£å†³è¶…å¤§å›¾æ”¾å¤§åç»˜åˆ¶å¡é¡¿é—®é¢˜
- ä¼˜åŒ–å…«ã€å››è§’æ§åˆ¶ç‚¹éšæ„æ‹–æ‹½æ”¾å¤§é•¿å’Œå®½ã€æ‘’å¼ƒç­‰æ¯”æ”¾å¤§ç¼©å°ã€‘
- END
## å‰è¨€
ç»è¿‡[Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸Šã€‘](https://blog.csdn.net/qq_42696432/article/details/149866418?fromshare=blogdetail&sharetype=blogdetail&sharerId=149866418&sharerefer=PC&sharesource=qq_42696432&sharefrom=from_link) çš„å­¦ä¹ ï¼Œå¼€å§‹è¿›å…¥å‰ç«¯æ ‡æ³¨å·¥å…·çš„å®æˆ˜é˜¶æ®µï¼Œè¯¥å·¥å…·å¯ä»¥è¿›è¡Œæºç äºŒæ¬¡å¼€å‘æˆ–è€…æ ¹æ®è‡ªå·±çš„æ ‡æ³¨éœ€æ±‚è¿›è¡Œæ‹“å±•ï¼Œç»“å°¾æœ‰è·å–æºç çš„æ–¹å¼~

## ä¸»ä½“åŠŸèƒ½
å½“å‰å·¥å…·å®ç°äº†`labelImgçš„`æ ‡æ³¨åŠŸèƒ½ï¼Œå…¶ä¸­æœ‰ï¼š
> 1. è¾…åŠ©çº¿åŠŸèƒ½ï¼Œæ–¹ä¾¿æŸ¥çœ‹æ ‡æ³¨è¿‡ç¨‹ä¸­çš„å‚ç…§ä½ç½®ã€‚ã€å¯å¼€å…³æ§åˆ¶ã€‘
> 2. é¼ æ ‡æŒ‡å‘ç‚¹æ»šè½®ç¼©æ”¾æˆ–ç‚¹å‡»ç¼©æ”¾æŒ‰é’®è¿›è¡Œç¼©æ”¾åŠŸèƒ½ã€‚
> 3. è¿›è¡Œå¤§å›¾ç‰‡è‡ªé€‚åº”çª—å£åŠè‡ªé€‚åº”ç¼©æ”¾æŒ‰é’®åŠŸèƒ½ã€‚
> 4. è¿›è¡Œä¸Šä¸€å¼ ï¼Œä¸‹ä¸€å¼ å›¾ç‰‡æ ‡æ³¨åˆ‡æ¢åŠŸèƒ½ã€‚
> 5. å¯é€šè¿‡`â€wâ€œ`é”®è¿›è¡ŒçŸ©å½¢æ¡†çš„æ‹–æ‹½åˆ›å»ºç»˜åˆ¶ã€‚
> 6. å¯é€šè¿‡æŒ‰é’®è¿›è¡Œå¤šè¾¹å½¢æ¡†çš„å¤šç‚¹ç»˜åˆ¶åŠŸèƒ½ã€‚
> 7. å¯è¿›è¡ŒçŸ©å½¢æ¡†çš„æ‹–æ‹½ä¿®æ”¹å¤§å°ä»¥åŠåŒå‡»ä¿®æ”¹`label`æ ‡ç­¾å†…å®¹ã€‚
> 8. å¤šè¾¹å½¢åŒå‡»è¿›å…¥ç¼–è¾‘ï¼Œå†åŒå‡»è¿›å…¥é¢„è§ˆçŠ¶æ€ï¼Œå¯å¯¹é¡¶ç‚¹è¿›è¡Œæ‹–æ‹½ç¼–è¾‘åŠŸèƒ½ã€‚
> 9. å¯æ ¹æ®å®šä¹‰å¥½çš„çŸ©å½¢æ•°æ®ä»¥åŠå¤šè¾¹å½¢æ•°æ®è¿›è¡ŒçŸ©å½¢å¤šè¾¹å½¢çš„å›æ˜¾åŠŸèƒ½ã€‚
> 10. å¯è¿›è¡Œæ•°æ®çš„ç²¾ç¡®çš„å¯¼å‡ºï¼ŒçŸ©å½¢ã€å¯¼å‡ºä¸Šä¸‹å·¦å³ç‚¹ä½åŠä¸­å¿ƒç‚¹ã€‘ï¼Œå¤šè¾¹å½¢ã€å¯¼å‡ºå„ä¸ªç‚¹çš„ä½ç½®ã€‘
> 11. å¯åŒæ—¶æ ‡æ³¨å¤šè¾¹å½¢çŸ©å½¢ä¸”å¯ä»¥å±‚å ç»˜åˆ¶ï¼Œé¼ æ ‡ç§»å…¥é«˜äº®ç­‰å¯è§†åŒ–åŠŸèƒ½ã€‚
> 12. å›ºå®šå­—ç¬¦å›ºå®šéšæœºé¢œè‰²ã€‚
> 13. å¯å¯¹çŸ©å½¢å¤šè¾¹å½¢è¿›è¡Œå¤åˆ¶ç²˜è´´æ“ä½œã€‚ã€ä¼˜åŒ–ä¸€ã€‘
> 14. ä¸è§„åˆ™äº¤å‰å¤šè¾¹å½¢è§„åˆ™åŒ–é…ç½®å¼€å…³ã€‚ã€ä¼˜åŒ–äºŒã€‘
> 15. å¤šè¾¹å½¢åˆ›å»ºä¸é€‚ç”¨ä¸´æ—¶ç‚¹çº¿ï¼Œè€Œæ˜¯ä¸´æ—¶çŸ©å½¢ç‚¹çº¿ä¸”æœ€åä¸€ä¸ªç‚¹åŠ¨æ€ä¸´æ—¶çŸ©å½¢ã€ä¼˜åŒ–ä¸‰ã€‘
> 16. æ·»åŠ æ ‡æ³¨ç»“æœå¯¼å‡ºå›¾ç‰‡åŠŸèƒ½ã€ä¼˜åŒ–å››ã€‘
> 17. åˆ›å»ºå¤šè¾¹å½¢ä¸´æ—¶ç‚¹çº¿æ”¹ä¸ºä¸´æ—¶å¤šè¾¹å½¢ï¼Œä¸”ä¸´æ—¶å¤šè¾¹å½¢æœ€åä¸€ä¸ªç‚¹è·Ÿç€é¼ æ ‡å˜æ¢ã€‚ã€ä¼˜åŒ–äº”ã€‘
> 18. åˆ›å»ºå¤šè¾¹å½¢å’ŒçŸ©å½¢labelæ ‡ç­¾æ”¹ä¸ºä¸‹æ‹‰æ¡†é€‰æ‹©ã€ä¼˜åŒ–å…­ã€‘
> 19. è§£å†³é«˜æ¸…å¤§å›¾æ”¾å¤§åç»˜åˆ¶çŸ©å½¢å’Œå¤šè¾¹å½¢å‡ºç°å¡é¡¿é—®é¢˜ã€ä¼˜åŒ–ä¸ƒã€‘
> 20. ä»¿ç…§labelImgçŸ©å½¢æ ‡æ³¨ï¼Œé‡å†™å››ä¸ªè§’æ§åˆ¶çŸ©å½¢ï¼Œæ‘’å¼ƒç­‰æ¯”æ”¾å¤§ï¼Œå¯è¿›è¡Œæ‹–æ‹½æ”¹å˜é«˜å®½å€¼ã€ä¼˜åŒ–å…«ã€‘

![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/074acde8cd9f44cea9815d501bbd6d62.png)

## æ•ˆæœé¢„è§ˆ
çŸ©å½¢æ ‡æ³¨ï¼š
![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/b5730ad787ae44d8953da734f4548691.png)
å¤šè¾¹å½¢æ ‡æ³¨ï¼š
![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/5f6f3de94f28480795a95287860a59b5.png)
åå­—è¾…åŠ©çº¿
![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/79287769ef2946bf8783db8d304c704a.png)

å¯¼å‡ºæ•°æ®æ ¼å¼ï¼š
![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/6921c8b630b54e78a550f1c4fbf67f99.png)
æ ‡ç­¾ä¿®æ”¹ï¼š
![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/7d0c6359ec0e4fff9088e77d4daf11df.png)

å¤šè¾¹å½¢å›æ˜¾
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/fe68d03c31ea4a39a8ab6632a13920a7.gif)
å¤åˆ¶ç²˜è´´åŠŸèƒ½
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/a1e5cd4531eb46bfaced0665d833eb47.gif)
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/2c8fe1f3173a4ce08a798ca0a0ff6871.png)

å¤šè¾¹å½¢è§„åˆ™åŒ–æ·»åŠ ï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/d69280ec10154d03aafb935a7280f06b.gif)
å¤šè¾¹å½¢åˆ›å»ºä¼˜åŒ–ï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/c372a2ef92af42ec97e9a8d30a707dee.gif)

å¯¼å‡ºæ ‡æ³¨åŠŸèƒ½
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/a95c7454256f45fd9b7c60709dbb8bc4.gif)

[video(video-b6tnAS6E-1754957509822)(type-bilibili)(url-https://player.bilibili.com/player.html?aid=115009459849246)(image-https://i-blog.csdnimg.cn/img_convert/b70739ac58df67253c673ff916e02772.jpeg)(title-canvasæ ‡æ³¨)]




[video(video-QB7oHwHP-1754151835748)(type-bilibili)(url-https://player.bilibili.com/player.html?aid=114901800452347)(image-https://i-blog.csdnimg.cn/img_convert/d55912a59d0675fda9b463c99e2f53ff.jpeg)(title-çŸ©å½¢æ ‡æ³¨)]


[video(video-GZss0Dmm-1754451273780)(type-bilibili)(url-https://player.bilibili.com/player.html?aid=114960101280724)(image-https://i-blog.csdnimg.cn/img_convert/5df5346a18a502b14e9c7976dedfb980.jpeg)(title-å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·webç«¯)]

## å®ç°æ­¥éª¤

### ç¬¬ä¸€æ­¥ã€å¸ƒå±€å®ç°

> - å·¦ä¾§å·¥å…·æ ï¼šåŒ…å«å„ç§å·¥å…·æŒ‰é’®ï¼Œå¦‚è¾…åŠ©çº¿ã€ä¿å­˜ã€å›¾ç‰‡åˆ‡æ¢æŒ‰é’®ç­‰ã€‚
> - ä¸­é—´å›¾åƒåŒºåŸŸï¼šæ˜¾ç¤ºéœ€è¦æ ‡æ³¨çš„å›¾åƒï¼Œå¹¶ä¸”æœ‰ç»¿è‰²çº¿æ¡è¾…åŠ©æ ‡æ³¨ã€‚
> - å³ä¾§æ ‡ç­¾åˆ—è¡¨ï¼šæ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨å’Œæ ‡ç­¾ä¿¡æ¯

![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/5bd8818bb99f46ef87f7fc572518bbee.png)
æˆ‘æ¯”è¾ƒç›´æ¥ï¼Œä½¿ç”¨äº†ç»å¯¹å®šä½å®ç°çš„åœ£æ¯å¸ƒå±€ï¼š
- `.left-menu` ç±»è®¾ç½®äº†å·¦è¾¹æ ï¼Œå…¶å®½åº¦å›ºå®šä¸º`122px`ã€‚
- `.right-list` ç±»è®¾ç½®äº†å³è¾¹æ ï¼Œå…¶å®½åº¦å›ºå®šä¸º`230px`ã€‚
- `.canvas-box` ç±»ä»£è¡¨ä¸­å¤®å†…å®¹åŒºï¼Œå®ƒçš„å·¦å³ä½ç½®åˆ†åˆ«ç”±å·¦è¾¹æ å’Œå³è¾¹æ çš„å®½åº¦å†³å®šï¼Œå¹¶ä¸”é€šè¿‡è®¾ç½® `left:122px; right: 230px;` æ¥ç¡®ä¿ä¸­å¤®å†…å®¹åŒºä¸ä¼šä¸ä¸¤è¾¹æ é‡å ã€‚

```css
.right-list {
    position: absolute;
    top: 0;
    right: 0;
    height: 100%;
    width: 230px;
    background: #f0f0f0;
 }
 .left-menu {
    position: absolute;
    left: 0;
    height: 100%;
    width: 122px;
    padding-top: 5px;
    background: #f0f0f0;
    position: relative; /* ç¡®ä¿ä¼ªå…ƒç´ ç›¸å¯¹äºè¿™ä¸ªå…ƒç´ å®šä½ */
  }
  .canvas-box {
    position: absolute;
    left: 122px;
    right: 230px;
    top: 0;
    bottom: 0;
    overflow: hidden;
 }
```
ä½¿ç”¨ç»å¯¹å®šä½æ¥å®‰æ’é¡µé¢å…ƒç´ çš„æ–¹å¼æ˜¯å®ç°åœ£æ¯å¸ƒå±€çš„ä¸€ç§æ–¹æ³•ã€‚ä¹Ÿå¯ä»¥ä¸ä½¿ç”¨æˆ‘çš„è¿™ç§å¸ƒå±€ï¼Œè‡ªè¡Œä½¿ç”¨ã€`flex`å¸ƒå±€ï¼Œ`grid`å¸ƒå±€ï¼Œ`float`æµ®åŠ¨å¸ƒå±€ã€‘ç­‰å¾ˆå¤šæ–¹æ³•éƒ½å¯å®ç°ã€‚
### ç¬¬äºŒæ­¥ã€ä¸‹è½½å¹¶å¼•å…¥fabric.jså¯¹è±¡åŠåŠŸèƒ½æ–¹æ³•
ä¸‹è½½ï¼š
```javascript
npm install fabric
æˆ–è€…
yarn add fabric
```

å¼•å…¥ï¼š
```javascript
import {
  Canvas, // è¿™æ˜¯ Fabric.js çš„æ ¸å¿ƒç±»ï¼Œä»£è¡¨æ•´ä¸ªç”»å¸ƒï¼ˆCanvasï¼‰å®ä¾‹ã€‚
  Line,  // ç”¨äºåˆ›å»ºç›´çº¿å¯¹è±¡
  Group,  // å°†å¤šä¸ª Fabric å¯¹è±¡ç»„åˆæˆä¸€ä¸ªç»„ï¼ˆGroupï¼‰ï¼Œå¯ä»¥ç»Ÿä¸€è¿›è¡Œç§»åŠ¨ã€ç¼©æ”¾ã€æ—‹è½¬ç­‰æ“ä½œã€‚
  FabricImage,  // ç”¨äºåŠ è½½å’Œæ“ä½œå›¾ç‰‡å¯¹è±¡ã€‚
  controlsUtils, // æä¾›ä¸æ§ä»¶ç›¸å…³çš„å®ç”¨å·¥å…·å‡½æ•°ï¼Œç”¨äºè‡ªå®šä¹‰å¯¹è±¡çš„æ§åˆ¶ç‚¹ï¼ˆå¦‚ç¼©æ”¾ã€æ—‹è½¬æ‰‹æŸ„ï¼‰ã€‚
  Rect, // åˆ›å»ºçŸ©å½¢å¯¹è±¡ã€‚
  Point, // è¡¨ç¤ºä¸€ä¸ªäºŒç»´åæ ‡ç‚¹ï¼ˆx, yï¼‰ã€‚
  Textbox, // å¯ç¼–è¾‘çš„å¤šè¡Œæ–‡æœ¬æ¡†å¯¹è±¡ã€‚
  Control, // å®šä¹‰ç”»å¸ƒå¯¹è±¡ä¸Šçš„æ§åˆ¶ç‚¹ï¼ˆå°æ–¹å—æ‰‹æŸ„ï¼‰ï¼Œæ¯”å¦‚ç¼©æ”¾ã€æ—‹è½¬ã€ç§»åŠ¨ç­‰
  util, // Fabric.js æä¾›çš„é€šç”¨å·¥å…·å‡½æ•°é›†åˆã€‚
  Circle, // åˆ›å»ºåœ†å½¢å¯¹è±¡ã€‚
  Text, // åˆ›å»ºé™æ€æ–‡æœ¬å¯¹è±¡ï¼ˆä¸å¯ç¼–è¾‘ï¼‰ã€‚
  Polygon, // åˆ›å»ºå¤šè¾¹å½¢å¯¹è±¡ã€‚
} from "fabric";
```

### ç¬¬ä¸‰æ­¥ã€åˆå§‹åŒ–ç”»å¸ƒ
ä½¿ç”¨`Fabric.js`åˆ›å»ºç”»å¸ƒï¼Œå¹¶åŠ è½½å½“å‰å›¾ç‰‡ã€‚æ³¨æ„è®¾ç½®ç”»å¸ƒå°ºå¯¸ä¸ºçˆ¶å®¹å™¨å¤§å°ï¼Œå¹¶å¤„ç†å›¾ç‰‡çš„ç¼©æ”¾å’Œå±…ä¸­ã€‚

```javascript
// åˆå§‹åŒ– Fabric ç”»å¸ƒ
function initFabricCanvas() {
  // ç¡®è®¤canvaså…ƒç´ æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨return
  if (!canvas.value) return;
  // è·å–ç”»å¸ƒçš„çˆ¶å®¹å™¨å…ƒç´ 
  const container = canvas.value.parentElement;
  // ç¡®è®¤çˆ¶å®¹å™¨å…ƒç´ å­˜åœ¨ï¼Œä¸å­˜åœ¨return
  if (!container) return;
  // åˆ›å»ºæ–°çš„Fabricå¸ƒå®ä¾‹ï¼Œå¹¶è®¾å®½é«˜èƒŒæ™¯é¢œè‰²å±æ€§
  fCanvas = new Canvas(canvas.value, {
    width: container.clientWidth, // è®¾ç½®Fabricçš„å®½åº¦ä¸ºå®¹å™¨çš„å®½åº¦
    height: container.clientHeight, // è®¾ç½®Fabricçš„é«˜åº¦ä¸ºå®¹å™¨çš„é«˜åº¦
    // backgroundColor: "#ffff00", // è®¾ç½®èƒŒæ™¯é¢œè‰²ä¸ºé»„è‰²
    selection: true, // å…³é—­é€‰æ‹©åŠŸèƒ½
    preserveObjectStacking: true, // å…è®¸å¯¹è±¡å †æ ˆæ”¹å˜
    altSelectionKey: "altKey",
  });
}
```
### ç¬¬å››æ­¥ã€æ ‡æ³¨å›¾ç‰‡åˆå§‹åŒ–
1. æ£€æŸ¥ `Fabric` ç”»å¸ƒæ˜¯å¦åˆå§‹åŒ–ï¼šåœ¨å¼€å§‹ä»»ä½•æ“ä½œä¹‹å‰ï¼Œé¦–å…ˆæ£€æŸ¥ `fCanvas` æ˜¯å¦å·²ç»åˆå§‹åŒ–ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™è¾“å‡ºè­¦å‘Šå¹¶é€€å‡ºå‡½æ•°ï¼Œé˜²æ­¢åç»­æ“ä½œå‡ºé”™ã€‚
2. åŠ è½½å›¾ç‰‡ï¼šé€šè¿‡è°ƒç”¨ `FabricImage.fromURL` æ–¹æ³•ï¼ˆè¿™é‡Œå‡è®¾æ˜¯ `Fabric.js` æä¾›çš„ç”¨äºåŠ è½½å›¾ç‰‡çš„æ–¹æ³•ï¼‰ï¼Œä»æŒ‡å®šçš„ `URL` åŠ è½½å›¾ç‰‡ã€‚åŠ è½½æ—¶è®¾ç½®äº†è·¨åŸŸèµ„æºå…±äº«`(CORS)`ä¸ºåŒ¿åæ¨¡å¼ï¼Œä»¥ä¾¿å¤„ç†è·¨åŸŸå›¾ç‰‡èµ„æºçš„é—®é¢˜ã€‚
3. è®¡ç®—ç¼©æ”¾æ¯”ä¾‹å’Œè°ƒæ•´å›¾ç‰‡å°ºå¯¸ï¼šæ ¹æ®çˆ¶å®¹å™¨çš„é«˜åº¦æ¥è®¡ç®—å›¾ç‰‡éœ€è¦ç¼©æ”¾çš„æ¯”ä¾‹ï¼Œä½¿å¾—å›¾ç‰‡èƒ½é€‚åº”å®¹å™¨çš„é«˜åº¦ã€‚åŒæ—¶ä¿å­˜è¿™ä¸ªç¼©æ”¾æ¯”ä¾‹ï¼Œå¯èƒ½ç”¨äºåç»­çš„æ“ä½œã€‚
4. é…ç½®å¹¶æ·»åŠ å›¾ç‰‡åˆ°ç”»å¸ƒï¼šå°†åŠ è½½çš„å›¾ç‰‡åº”ç”¨ä¸Šè¿°è®¡ç®—å¥½çš„ç¼©æ”¾æ¯”ä¾‹ï¼Œå¹¶è®¾ç½®å…¶åœ¨ç”»å¸ƒä¸­çš„ä½ç½®ä¸ºå±…ä¸­ã€‚ç„¶åæ›´æ–°ç”»å¸ƒå°ºå¯¸ä½¿å…¶åŒ¹é…å®¹å™¨å°ºå¯¸ï¼Œå¹¶å°†å›¾ç‰‡å¯¹è±¡æ·»åŠ åˆ°ç”»å¸ƒä¸­æ˜¾ç¤ºå‡ºæ¥ã€‚
5. ç»˜åˆ¶å·²æœ‰æ ‡ç­¾æ•°æ®ï¼šå¦‚æœæœ‰é’ˆå¯¹å½“å‰å›¾ç‰‡çš„æ ‡ç­¾æ•°æ®ï¼ˆå¦‚æ ‡æ³¨ä¿¡æ¯ï¼‰ï¼Œåˆ™è°ƒç”¨ `drawLabels` å‡½æ•°è¿›è¡Œç»˜åˆ¶ï¼Œè¿™é€šå¸¸ç”¨äºå›¾åƒæ ‡æ³¨å·¥å…·ä¸­ã€‚
6. å®ç°äº¤äº’å¼åå­—è¾…åŠ©çº¿ï¼šä¸ºäº†å¢å¼ºç”¨æˆ·ä½“éªŒï¼Œå‡½æ•°è¿˜åˆ›å»ºäº†ä¸€ä¸ªé¢å¤–çš„é€æ˜ `Canvas` å±‚ï¼Œç”¨äºåœ¨ç”¨æˆ·é¼ æ ‡ç§»åŠ¨æ—¶åŠ¨æ€ç»˜åˆ¶åå­—è¾…åŠ©çº¿ï¼Œä»è€Œæä¾›ç²¾ç¡®çš„ä½ç½®æŒ‡ç¤ºã€‚
7. äº‹ä»¶ç›‘å¬ä¸å¤„ç†ï¼šé€šè¿‡ç›‘å¬å®¹å™¨çš„é¼ æ ‡ç§»åŠ¨å’Œç¦»å¼€äº‹ä»¶ï¼Œå®ç°åœ¨ç”¨æˆ·ä¸ç”»å¸ƒäº¤äº’æ—¶å®æ—¶æ›´æ–°åå­—è¾…åŠ©çº¿çš„ä½ç½®ï¼Œæˆ–è€…åœ¨é¼ æ ‡ç¦»å¼€æ—¶æ¸…é™¤è¿™äº›è¾…åŠ©çº¿ã€‚
```javascript
// å¼‚æ­¥åŠ è½½å›¾ç‰‡
async function loadImage(url: string) {
  // å¦‚æœfabricæœªåˆå§‹åŒ–ï¼Œåˆ™è¾“å‡ºè­¦å‘Šå¹¶è¿”å›
  if (!fCanvas) {
    console.warn("fCanvas æœªåˆå§‹åŒ–");
    return;
  }
  // "http://192.168.80.32:8888/Image_20250306140749112.png"
  try {
    // ä½¿ç”¨FabricåŠ è½½å›¾ç‰‡ï¼Œå¹¶è®¾ç½®è·¨åŸŸèµ„æºå…±äº«(CORS)ä¸ºåŒ¿å
    const imgObj = await FabricImage.fromURL(url, { crossOrigin: "anonymous" });
    console.log("å›¾ç‰‡åŠ è½½å®Œæˆ", imgObj);
    // è·å–ç”»å¸ƒå®¹å™¨çš„Domå…ƒç´ ï¼Œå¹¶è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
    const container = fCanvas.getElement().parentElement as HTMLElement;
    const scale = container.clientHeight / imgObj.height!;

    imgScale = container.clientHeight / imgObj.height!;
    // imgObj.scale(imgScale);
    // åº”ç”¨ç¼©æ”¾æ¯”ä¾‹ï¼Œå¹¶è®¾ç½®å›¾ç‰‡åœ¨ç”»å¸ƒä¸­çš„ä½ç½®
    imgObj.scale(scale);
    // è®¾ç½®å›¾ç‰‡çš„å±…ä¸­ä½ç½®
    imgObj.set({
      originX: "center",
      originY: "center",
      left: fCanvas.getWidth() / 2,
      top: fCanvas.getHeight() / 2,
      selectable: false,
      evented: false,
    });
    // æ›´æ–°ç”»å¸ƒå°ºå¯¸ï¼Œå¹¶æ·»åŠ å›¾ç‰‡å¯¹è±¡åˆ°ç”»å¸ƒä¸­
    fCanvas.setDimensions({
      width: container.clientWidth,
      height: container.clientHeight,
    });
    // åˆ·æ–°ç”»å¸ƒä»¥æ˜¾ç¤ºå›¾ç‰‡
    fCanvas.add(imgObj);
    // é‡ç½®è§†å£å˜æ¢ï¼Œå¹¶è¯·æ±‚é‡æ–°æ¸²æŸ“æ•´ä¸ªç”»å¸ƒ
    fCanvas.setViewportTransform([1, 0, 0, 1, 0, 0]);
    fCanvas.requestRenderAll();
    drawLabels(imageLabelData[currentIndex.value].labelInfo, imgObj);

    // åˆ›å»ºæˆ–è·å–é¡¶å±‚canvas
    const crossCanvas = createCrossCanvas(container);
    crossCanvasDom.value = createCrossCanvas(container);
    const ctx = crossCanvas.getContext("2d")!;
    // ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶ç»˜åˆ¶åå­—çº¿ï¼ˆæ³¨æ„è¦å…ˆè§£ç»‘é¿å…é‡å¤ç»‘å®šï¼‰
    container.removeEventListener("mousemove", onMouseMove);
    container.addEventListener("mousemove", onMouseMove);
    container.removeEventListener("mouseleave", onMouseLeave);
    container.addEventListener("mouseleave", onMouseLeave);

    function onMouseMove(e: MouseEvent) {
      const rect = crossCanvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      if (!isShowCrosshairImpont.value) return; // æ˜¾ç¤ºä¼˜å…ˆçº§å¤§äºisCrosshair
      if (!isCrosshair.value) return;
      ctx.clearRect(0, 0, crossCanvas.width, crossCanvas.height);
      ctx.beginPath();
      ctx.strokeStyle = "#00ff01";
      ctx.lineWidth = 0.8;
      // æ¨ªçº¿
      ctx.moveTo(0, y);
      ctx.lineTo(crossCanvas.width, y);
      // çºµçº¿
      ctx.moveTo(x, 0);
      ctx.lineTo(x, crossCanvas.height);
      ctx.stroke();
    }
    function onMouseLeave() {
      ctx.clearRect(0, 0, crossCanvas.width, crossCanvas.height);
    }
  } catch (err) {
    // æ•è·ä»»ä½•å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼Œå¹¶è¾“å‡ºé”™è¯¯ä¿¡æ¯
    console.error("å›¾ç‰‡åŠ è½½å¤±è´¥", err);
  }
}
```
### ç¬¬äº”æ­¥ã€è®¾ç½®ç”»å¸ƒåŠå…¶ä»–äº‹ä»¶ç›‘å¬å™¨

å®ç°`setupEventListeners`äº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨äºå®ç°ç»Ÿä¸€ç®¡ç†æ‰€æœ‰ç”¨æˆ·äº¤äº’è¡Œä¸ºï¼ŒåŒ…æ‹¬ï¼š
> - æŒ‰ W é”®è¿›å…¥çŸ©å½¢æ¡†ç»˜åˆ¶æ¨¡å¼
> - é¼ æ ‡æ‹–æ‹½è¿›è¡ŒçŸ©å½¢æ ‡æ³¨
> - æ”¯æŒå¤šè¾¹å½¢ç»˜åˆ¶
> - åŒå‡»ä¿®æ”¹æ ‡ç­¾
> - æ‹–æ‹½å¹³ç§»ç”»å¸ƒï¼ˆé…åˆ `Ctrl`ï¼‰
> - é¼ æ ‡æ»šè½®ç¼©æ”¾ï¼ˆé…åˆ `Ctrl`ï¼‰
> - å®æ—¶æ›´æ–°æ ‡æ³¨åæ ‡ï¼ˆç§»åŠ¨/ç¼©æ”¾åè‡ªåŠ¨è½¬æ¢åæ ‡ï¼‰

æˆ‘è¿™è¾¹å†åšç›‘å¬ä¹‹å‰å…ˆæ£€æŸ¥ä¸€ä¸‹äº‹ä»¶æ˜¯å¦é‡å¤ç›‘å¬å»é‡æ“ä½œ

```javascript
if (!fCanvas) return;
fCanvas.off("mouse:down"); // è§£ç»‘æ—§çš„äº‹ä»¶ï¼Œé˜²æ­¢é‡å¤ç»‘å®š
```
å¤§æ¦‚äº‹ä»¶ç›‘å¬ä»£ç å¦‚ä¸‹ï¼š

```javascript

// ç»‘å®šäº‹ä»¶ï¼šå¹³ç§»ã€ç¼©æ”¾
function setupEventListeners() {
  // å¦‚æœFabricç”»å¸ƒæœªåˆå§‹åŒ–ï¼Œåˆ™ç›´æ¥è¿”å›
  if (!fCanvas) return;
  // è§£ç»‘æ—§çš„ mouse:down ç›‘å¬ï¼Œé¿å…åˆ‡æ¢å›¾ç‰‡çš„æ—¶å€™å åŠ ä¸Šä¸€å¼ å›¾çš„äº‹ä»¶
  fCanvas.off("mouse:down");
  // é”®ç›˜ç›‘å¬
  window.addEventListener("keydown", (e) => {
    // å¦‚æœæŒ‰ä¸‹Wé”®ï¼Œåˆ™å¼€å§‹ç»˜åˆ¶
  });
  window.addEventListener("keyup", (e) => {
    if (e.key === "w" || drawing) {
      // drawing = false;
      fCanvas.selection = false;
    }
  });
  // é¼ æ ‡æŒ‰ä¸‹
  fCanvas.on("mouse:down", (opt) => {
    const obj = opt.target as any;
    const target = opt.target as any; 
    const e = opt.e as MouseEvent;
    if (!opt.target) {
      // ç”¨æˆ·ç‚¹å‡»ç”»å¸ƒç©ºç™½å¤„
     
    } else {
      const obj = opt.target as any;
      if (obj.boxId) {
       // ç‚¹å‡»çŸ©å½¢æ¡†
      }
    }
    if (!drawingPolygon.value) return;
    const pointer = fCanvas.getPointer(opt.e);
    const point = { x: pointer.x, y: pointer.y };
    currentPolygonPoints.push(point);
    // åˆ›å»ºå¹¶æ·»åŠ ä¸´æ—¶åœ†ç‚¹...
    fCanvas.add(circle);
    tempCirclePoints.push(circle);

    // è¿›è¡Œä¸´æ—¶è¿çº¿æ“ä½œ
    ...
      fCanvas.add(line);
      tempLinePoints.push(line);
    }

    // æ£€æµ‹æ˜¯å¦é—­åˆï¼ˆç‚¹å‡»ç¬¬ä¸€ä¸ªç‚¹é™„è¿‘ï¼‰
    if (currentPolygonPoints.length >= 3) {
      const first = currentPolygonPoints[0];
      const dx = point.x - first.x;
      const dy = point.y - first.y;
      if (Math.sqrt(dx * dx + dy * dy) < 10) {
        finalizePolygon();
      }
    }
  });

  // å…¨éƒ¨å¯é€‰é¡¹è¿›è¡ŒåŒå‡»ä¿®æ”¹æ ‡ç­¾å†…å®¹
  fCanvas.on("mouse:dblclick", (e) => {
  	// ä¿®æ”¹æ ‡ç­¾å¼¹çª—
  });

  // å¯¹è±¡å•é€‰æ—¶ä¹Ÿè§¦å‘
  fCanvas.on("object:modified", (e) => {
    // å½“å¯¹è±¡è¿›è¡Œå¹³ç§»åæ ¹æ®ç¼©æ”¾å’Œå¹³ç§»è·ç¦»ç²¾ç¡®è®¡ç®—å‡ºå„ä¸ªç‚¹çš„ä½ç½®
  });

  // ç›‘å¬é¼ æ ‡æŒ‰ä¸‹äº‹ä»¶
  fCanvas.on("mouse:down", (opt) => {
   ...
  });

  // ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶
  fCanvas.on("mouse:move", (opt) => {
   
  });

  // ç›‘å¬é¼ æ ‡æŠ¬èµ·äº‹ä»¶
  fCanvas.on("mouse:up", (opt) => {
   
  });
  // ç›‘å¬é¼ æ ‡æ»šè½®äº‹ä»¶ä¸”ä¸ctrlé…åˆä½¿ç”¨æ‰ä¼šç”Ÿæ•ˆ
  fCanvas.on("mouse:wheel", (opt) => {
    
  });
}
```
### ç¬¬å…­æ­¥ã€ çŸ©å½¢æ ‡æ³¨å®ç°
æ‹–æ‹½ç»“æŸåï¼Œè®°å½•é¼ æ ‡æœ€åå‡ºç°ä½ç½®ï¼Œå¼¹å‡ºæ ‡æ³¨æ¡†ã€‚
```javascript
// åˆ›å»ºçŸ©å½¢æ ‡æ³¨
function createRectangles() {
  drawing = true;
  fCanvas.selection = false;
  fCanvas.defaultCursor = "crosshair";
}

// ç»˜åˆ¶çŸ©å½¢é€»è¾‘
fCanvas.on("mouse:down", (opt) => {
  if (drawing) {
    const e = opt.e as MouseEvent;
    const p = fCanvas.getPointer(e);
    startX = p.x;
    startY = p.y;
    
    // åˆ›å»ºä¸´æ—¶çŸ©å½¢
    tempRect = new Rect({
      left: startX,
      top: startY,
      width: 0,
      height: 0,
      fill: "rgba(123, 217, 31,0.05)",
      stroke: "#7BD91F",
      strokeWidth: 1,
    });
    
    fCanvas.add(tempRect);
  }
});

// é¼ æ ‡ç§»åŠ¨æ—¶æ›´æ–°çŸ©å½¢å°ºå¯¸
fCanvas.on("mouse:move", (opt) => {
  if (drawing && tempRect) {
    const e = opt.e as MouseEvent;
    const p = fCanvas.getPointer(e);
    
    tempRect.set({
      width: Math.abs(p.x - startX),
      height: Math.abs(p.y - startY),
      left: p.x < startX ? p.x : startX,
      top: p.y < startY ? p.y : startY,
    });
    
    tempRect.setCoords();
    fCanvas.requestRenderAll();
  }
});
```
### ç¬¬ä¸ƒæ­¥ã€å¤šè¾¹å½¢æ ‡æ³¨å®ç°
æˆ‘å½“å‰æ˜¯é€šè¿‡ç‚¹å‡»æ¯ä¸ªç‚¹è¿›è¡Œè¿æˆçº¿ç»˜åˆ¶å¤šè¾¹å½¢ï¼Œä¸‰ä¸ªç‚¹å³å¯å˜æˆä¸€ä¸ªå¤šè¾¹å½¢ï¼Œå½“å‰ç‚¹æ•°`>3`çš„æ—¶å€™ä¸”ç¬¬ä¸€ä¸ªç‚¹è¢«äºŒæ¬¡ç‚¹å‡»çš„æ—¶å€™ä»£è¡¨å¤šè¾¹å½¢æ ‡æ³¨å®Œæˆï¼Œå³å¯è¿›è¡Œå¤šè¾¹å½¢æ ‡æ³¨ç»“æŸã€‚
```javascript
// å¤šè¾¹å½¢ç»˜åˆ¶æ¨¡å¼åˆ‡æ¢
function createPolygon() {
  drawingPolygon.value = !drawingPolygon.value;
  if (!drawingPolygon.value) {
    clearTempDraw();
  }
}

// å¤šè¾¹å½¢ç‚¹æ·»åŠ é€»è¾‘
fCanvas.on("mouse:down", (opt) => {
  if (!drawingPolygon.value) return;
  
  const pointer = fCanvas.getPointer(opt.e);
  const point = { x: pointer.x, y: pointer.y };
  currentPolygonPoints.push(point);
  
  // æ·»åŠ æ§åˆ¶ç‚¹
  const circle = new Circle({
    left: point.x,
    top: point.y,
    radius: 3,
    fill: "red",
  });
  
  fCanvas.add(circle);
  tempCirclePoints.push(circle);
  
  // æ·»åŠ è¿çº¿
  if (currentPolygonPoints.length > 1) {
    const prev = currentPolygonPoints[currentPolygonPoints.length - 2];
    const line = new Line([prev.x, prev.y, point.x, point.y], {
      stroke: "red",
      strokeWidth: 1,
    });
    
    fCanvas.add(line);
    tempLinePoints.push(line);
  }
});

// å¤šè¾¹å½¢é—­åˆé€»è¾‘
function finalizePolygon() {
  currentPolygonPoints.pop();
  
  // åˆ›å»ºå¤šè¾¹å½¢å¯¹è±¡
  const polygon = new Polygon(currentPolygonPoints, {
    stroke: "red",
    strokeWidth: 1,
    fill: `rgba(149, 204, 100,0.2)`,
    objectCaching: false,
    selectable: true,
  });
  
  fCanvas.add(polygon);
  
  // æ·»åŠ æ ‡ç­¾
  const center = polygon.getCenterPoint();
  const tb = new Textbox(label, {
    left: center.x,
    top: center.y,
    fontSize: 16,
    fill: `rgb(${rgb.r}, ${rgb.g}, ${rgb.b})`,
  });
  
  fCanvas.add(tb);
  
  // ä¿å­˜å¤šè¾¹å½¢æ•°æ®
  imageLabelData[currentIndex.value].labelPolygonInfo.push({
    labelText: label,
    id: polygonId,
    circlePoints: [...pointCacheData],
  });
}
```
### ç¬¬å…«æ­¥ã€åæ ‡è½¬æ¢ç³»ç»Ÿ
å› ä¸ºå›¾ç‰‡ä¼šè¿›è¡Œæ”¾å¤§ç¼©å°å’Œæ‹–æ‹½ç§»åŠ¨çš„é—®é¢˜ï¼Œæˆ‘éœ€è¦å°†æœ€ç»ˆç‚¹ä½ç»“æœè¿›è¡Œè®¡ç®—å¾—å‡ºç¼©æ”¾å’Œæ‹–æ‹½å‰çš„ä½ç½®ã€‚
```javascript
// ç”»å¸ƒåæ ‡è½¬å›¾åƒåŸå§‹åæ ‡
function toImageOriginalPos(point: Point) {
  const zoom = fCanvas.getZoom();
  const vpt = fCanvas.viewportTransform || [1, 0, 0, 1, 0, 0];
  
  // ç§»é™¤ç”»å¸ƒå˜æ¢
  const canvasX = (point.x - vpt[4]) / zoom;
  const canvasY = (point.y - vpt[5]) / zoom;
  
  // è½¬æ¢ä¸ºç›¸å¯¹äºå›¾åƒå·¦ä¸Šè§’çš„åæ ‡
  const relativeX = canvasX - imgLeft;
  const relativeY = canvasY - imgTop;
  
  // è½¬æ¢ä¸ºåŸå§‹å›¾åƒåƒç´ åæ ‡
  return {
    x: (relativeX / img.scaleX!) * zoom,
    y: (relativeY / img.scaleY!) * zoom,
  };
}
```
### ç¬¬ä¹æ­¥ã€æ ‡ç­¾ç®¡ç†

```javascript
// æ ‡ç­¾ç¼–è¾‘
function startEditLabel(id: string, type?: any) {
  if (type == "rect") {
    const label = imageLabelData[currentIndex.value].labelInfo.find(
      (b: any) => b.id === id
    );
    editLabelText.value = label.labelText;
    editingLabelId.value = id;
    editingLabel.value = true;
  }
}

// æ ‡ç­¾åˆ é™¤
function removeBox(id: string) {
  const targets = fCanvas.getObjects().filter((o) => (o as any).boxId === id);
  targets.forEach((o) => {
    fCanvas.remove(o);
  });
  
  imageLabelData[currentIndex.value].labelInfo = imageLabelData[
    currentIndex.value
  ].labelInfo.filter((b) => b.id !== id);
}
```
### ç¬¬åæ­¥ã€åå­—è¾…åŠ©çº¿åˆ›å»º
å½“æ—¶å®ç°çš„æ—¶å€™éƒ½åœ¨ç»Ÿä¸€å›¾å±‚é‡Œé¢è¿›è¡Œå®ç°çš„ï¼Œå½“å®Œæˆåå‘ç°ï¼Œæˆ‘çš„åå­—è¾…åŠ©çº¿çš„åŠŸèƒ½ä¸æˆ‘çš„å›¾ç‰‡æ ‡æ³¨ä¸€å±‚ç”»å¸ƒå‡ºç°äº†äº‹ä»¶å†²çªï¼Œå„ç§å†²çªé—®é¢˜å¾ˆéš¾ç»“å±€ï¼Œæœ€åå†³å®šåœ¨`Fabric.js`ç”»å¸ƒä¹‹ä¸Šåˆ›å»ºä¸€ä¸ªé€æ˜çš„`Canvas`è¦†ç›–å±‚ï¼Œä¸“é—¨ç”¨äºç»˜åˆ¶è·Ÿéšé¼ æ ‡çš„åå­—çº¿ã€‚ä¸ä¼šå¹²æ‰°åº•å±‚`Fabric.js`çš„ç”»å¸ƒå†…å®¹ï¼Œå¯ä»¥è½»æ¾æ§åˆ¶åå­—çº¿çš„æ˜¾ç¤º/éšè—ï¼Œç‹¬ç«‹äº`Fabric.js`çš„æ¸²æŸ“æœºåˆ¶ï¼Œæ€§èƒ½å¼€é”€å°ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹

1. åˆ›å»ºè¾…åŠ©canvaså±‚

```javascript
function createCrossCanvas(container: HTMLElement) {
  // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è¾…åŠ©Canvas
  let crossCanvas = container.querySelector<HTMLCanvasElement>(".cross-canvas");
  if (crossCanvas) return crossCanvas;

  // åˆ›å»ºæ–°çš„Canvaså…ƒç´ 
  crossCanvas = document.createElement("canvas");
  crossCanvas.classList.add("cross-canvas");
  
  // è®¾ç½®Canvasæ ·å¼
  crossCanvas.style.position = "absolute";
  crossCanvas.style.top = "0";
  crossCanvas.style.left = "0";
  crossCanvas.style.width = "100%";
  crossCanvas.style.height = "100%";
  crossCanvas.style.pointerEvents = "none"; // å…³é”®ï¼šå…è®¸äº‹ä»¶ç©¿é€
  crossCanvas.style.zIndex = "9999"; // ç¡®ä¿åœ¨æœ€ä¸Šå±‚
  
  // æ·»åŠ åˆ°å®¹å™¨
  container.appendChild(crossCanvas);

  // è®¾ç½®Canvasç‰©ç†å°ºå¯¸ï¼ˆé˜²æ­¢æ¨¡ç³Šï¼‰
  crossCanvas.width = container.clientWidth;
  crossCanvas.height = container.clientHeight;

  return crossCanvas;
}
```
2. åœ¨å›¾åƒåŠ è½½æ—¶åˆå§‹åŒ–è¾…åŠ©`Canvas`

```javascript
async function loadImage(url: string) {
  // ...å…¶ä»–å›¾åƒåŠ è½½é€»è¾‘...
  
  // åˆ›å»ºæˆ–è·å–è¾…åŠ©Canvas
  const crossCanvas = createCrossCanvas(container);
  
  // è·å–2Dç»˜å›¾ä¸Šä¸‹æ–‡
  const ctx = crossCanvas.getContext("2d")!;
  
  // ç»‘å®šé¼ æ ‡ç§»åŠ¨äº‹ä»¶
  container.removeEventListener("mousemove", onMouseMove);
  container.addEventListener("mousemove", onMouseMove);
  
  // ç»‘å®šé¼ æ ‡ç¦»å¼€äº‹ä»¶
  container.removeEventListener("mouseleave", onMouseLeave);
  container.addEventListener("mouseleave", onMouseLeave);
  
  // ...å…¶ä»–é€»è¾‘...
}
```
3. å®ç°é¼ æ ‡ç§»åŠ¨äº‹ä»¶å¤„ç†

```javascript
function onMouseMove(e: MouseEvent) {
  // è®¡ç®—é¼ æ ‡åœ¨Canvasä¸­çš„ç›¸å¯¹ä½ç½®
  const rect = crossCanvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
  
  // æ£€æŸ¥æ˜¯å¦åº”è¯¥æ˜¾ç¤ºåå­—çº¿
  if (!isShowCrosshairImpont.value) return;
  if (!isCrosshair.value) return;
  
  // æ¸…é™¤ä¸Šä¸€å¸§çš„ç»˜åˆ¶
  ctx.clearRect(0, 0, crossCanvas.width, crossCanvas.height);
  
  // å¼€å§‹ç»˜åˆ¶æ–°çš„åå­—çº¿
  ctx.beginPath();
  ctx.strokeStyle = "#00ff01"; // äº®ç»¿è‰²
  ctx.lineWidth = 0.8; // ç»†çº¿
  
  // ç»˜åˆ¶æ¨ªçº¿
  ctx.moveTo(0, y);
  ctx.lineTo(crossCanvas.width, y);
  
  // ç»˜åˆ¶çºµçº¿
  ctx.moveTo(x, 0);
  ctx.lineTo(x, crossCanvas.height);
  
  // å®Œæˆç»˜åˆ¶
  ctx.stroke();
}
```
4. å®ç°é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
```javascript
function onMouseLeave() {
  // é¼ æ ‡ç¦»å¼€æ—¶æ¸…é™¤åå­—çº¿
  ctx.clearRect(0, 0, crossCanvas.width, crossCanvas.height);
}
```


### ç¬¬åä¸€æ­¥ã€è‡ªå®šä¹‰æ§åˆ¶ç‚¹
å½“å¯¹è±¡è¢«é€‰ä¸­çš„æ—¶å€™ï¼Œä¼šå‡ºç°æ§åˆ¶ç‚¹ï¼Œ`fabric.js`ä¸­å°±æ”¯æŒäº†è‡ªå®šä¹‰æ§åˆ¶ç‚¹ï¼Œä¿®æ”¹å›è°ƒæ–¹æ³•è¿›è¡Œè‡ªå®šä¹‰æ§åˆ¶ç‚¹ã€‚
```javascript
function createCustomControls() {
  return {
    tl: new Control({ /* å·¦ä¸Šè§’æ§åˆ¶ç‚¹é…ç½® */ }),
    tr: new Control({ /* å³ä¸Šè§’æ§åˆ¶ç‚¹é…ç½® */ }),
    bl: new Control({ /* å·¦ä¸‹è§’æ§åˆ¶ç‚¹é…ç½® */ }),
    br: new Control({ /* å³ä¸‹è§’æ§åˆ¶ç‚¹é…ç½® */ }),
    ml: new Control({ /* å·¦è¾¹ä¸­ç‚¹æ§åˆ¶ç‚¹é…ç½® */ }),
    mr: new Control({ /* å³è¾¹ä¸­ç‚¹æ§åˆ¶ç‚¹é…ç½® */ }),
    mt: new Control({ /* ä¸Šè¾¹ä¸­ç‚¹æ§åˆ¶ç‚¹é…ç½® */ }),
    mb: new Control({ /* ä¸‹è¾¹ä¸­ç‚¹æ§åˆ¶ç‚¹é…ç½® */ }),
  };
}

// åº”ç”¨è‡ªå®šä¹‰æ§åˆ¶ç‚¹åˆ°çŸ©å½¢
rect.controls = createCustomControls();
```
### ç¬¬åäºŒæ­¥ã€åŸºäºæ ‡ç­¾æ–‡æœ¬ç”Ÿæˆå›ºå®šé¢œè‰²
é€šè¿‡å“ˆå¸Œæ•£åˆ—ç®—æ³•ï¼Œè®¡ç®—å¾—å‡ºå›ºå®šå­—ç¬¦ä¸²çš„å›ºå®šéšæœºé¢œè‰²ï¼Œä¸”å†ç³»ç»Ÿä¸­ç»Ÿä¸€ã€‚
```javascript
function stringToColour(str, isRgb = true) {
  // ç”ŸæˆMD5å“ˆå¸Œå€¼
  const hash = CryptoJS.MD5(str).toString();
  const colour = "#" + hash.substr(0, 6);
  // è½¬æ¢ä¸ºRGBæ ¼å¼
  if (isRgb) {
    return {
      r: parseInt(colour.substring(1, 3), 16),
      g: parseInt(colour.substring(3, 5), 16),
      b: parseInt(colour.substring(5, 7), 16)
    };
  }
  return colour;
}
```

### ç¬¬åä¸‰æ­¥ã€è¿›è¡ŒçŸ©å½¢çš„å›æ˜¾ç»˜åˆ¶
åœ¨ä¸€å¼€å§‹è¿›å…¥é¡µé¢åï¼Œéœ€è¦è¿›è¡ŒçŸ©å½¢ä¸å¤šè¾¹å½¢çš„å›æ˜¾æ•ˆæœï¼Œæ ¹æ®åç«¯è¿”å›çš„æ•°æ®æºè¿›è¡ŒçŸ©å½¢å¤šè¾¹å½¢çš„å›æ˜¾ï¼Œåç«¯å®šä¹‰å¥½å„ä¸ªç‚¹ä½çš„å›ºå®šæ•°æ®æ ¼å¼ä¿¡æ¯å³å¯ã€‚çŸ©å½¢ç»™å‡ºç‚¹ä½å¯ç»™å‡ºã€å››ä¸ªé¡¶ç‚¹åæ ‡ï¼Œä¸­å¿ƒåæ ‡ã€‘æˆ–è€…ã€å¯¹è§’åæ ‡å’Œä¸­å¿ƒåæ ‡ã€‘åˆæˆ–è€…ã€ä¸ç»™å‡ºä¸­å¿ƒåæ ‡ï¼Œåªç»™å‡ºä¸­å¿ƒåæ ‡å³å¯ã€‘ã€‚
```javascript
// ç»˜åˆ¶çŸ©å½¢æ ‡æ³¨æ¡†
function drawLabels(labelInfo: typeof labelData.labelInfo, imgObj: any) {
  const imgLeft = imgObj.left!;
  const imgTop = imgObj.top!;
  // è·å–åç§»é‡
  const originOffsetX = imgObj.getScaledWidth() / 2;
  const originOffsetY = imgObj.getScaledHeight() / 2;

  labelInfo.forEach((item) => {
    const [x1, y1] = item.pos1.map((v) => v * imgScale);
    const [x2, y2] = item.pos2.map((v) => v * imgScale);

    const left = imgLeft - originOffsetX + x1;
    const top = imgTop - originOffsetY + y1;
    const width = x2 - x1;
    const height = y2 - y1;
    // è·å–å­—ç¬¦ä¸²éšæœºä¸”å›ºå®šé¢œè‰²
    const rgbTempColor: any = stringToColour(item.labelText);
    console.log("RGB", rgbTempColor.r, rgbTempColor.g, rgbTempColor.b);
    const rect = new Rect({
      left,
      top,
      width,
      height,
      fill: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0)`, // å¡«å……é¢œè‰²
      stroke: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`, // è¾¹æ¡†é¢œè‰²
      strokeWidth: 1,
      selectable: true,
      cornerStrokeWidth: 1,
      strokeUniform: true, // ç¡®ä¿ç¼©æ”¾æ—¶æè¾¹å®½åº¦ä¸å˜
      originX: "left",
      originY: "top",
    });
    // åˆ›å»ºæ–‡å­—æ ‡ç­¾ï¼Œä¸åŠ å…¥ group
    const label = new Textbox(item.labelText, {
      left: left,
      top: top, // ğŸ‘ˆ æ˜¾ç¤ºåœ¨çŸ©å½¢ä¸Šæ–¹
      fontSize: 26,
      fill: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
      editable: false,
      borderColor: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
      selectable: false,
      evented: false, // ä¸å‚ä¸äº‹ä»¶
    });

    // è‡ªå®šä¹‰æ§åˆ¶ç‚¹
    rect.controls = createCustomControls();

    // æ·»åŠ å…ƒç´ 
    fCanvas.add(rect);
    fCanvas.add(label);

    // ä¿å­˜ label å¼•ç”¨åœ¨ rect ä¸Š
    (rect as any).labelRef = label;
    (rect as any).boxId = item.id;
    (label as any).boxId = item.id;

    // æ‹–åŠ¨æ—¶åŒæ­¥ label ä½ç½®
    rect.on("moving", () => {
      const r = rect as any;
      r.labelRef.set({
        left: r.left! + 5,
        top: r.top!,
      });
    });

    // rect.set({ hoverCursor: "pointer" });
    rect.on("mouseover", () => {
      // "rgba(0, 255, 0, 0.2)"
      rect.set(
        "fill",
        `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b},0.2)`
      );
      fCanvas.renderAll();
    });
    rect.on("mouseout", () => {
      rect.set(
        "fill",
        `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b},0)`
      );
      fCanvas.renderAll();
    });

    rect.on("mousedown", (e) => {
      // é€‰ä¸­å½“å‰ rectSmall å¯¹è±¡
      fCanvas.setActiveObject(rect);
      // é‡æ–°æ¸²å›¾â€”â€”å¿…è¦ï¼Œå¦åˆ™é€‰ä¸­æ¡†ä¸ä¼šå‡ºç°
      fCanvas.requestRenderAll();
      console.log("å·²é€‰ä¸­å°çŸ©å½¢", rect);
      const obj: any = e.target as any;
      if (obj && obj.boxId) {
        selectedLabelId.value = obj.boxId;
      }
    });
    // ç¼©æ”¾æ—¶åŒæ­¥ label ä½ç½®
    rect.on("scaling", () => {
      console.log("scalingè¢«ä¸€ç›´æ‰§è¡Œäº†");
      const r = rect as any;
      const boundingBox = rect.getBoundingRect(); // è·å–ç»å¯¹å·¦ä¸Šè§’
      r.labelRef.set({
        left: r.left! + r.getScaledWidth() / 2 - r.labelRef.width! / 2,
        top: r.top!,
      });
    });

    // åˆå§‹åŒ–åæ ‡
    rect.setCoords();
  });
  fCanvas.requestRenderAll();
}
```

### ç¬¬åå››æ­¥ã€çŸ©å½¢åŠå¤šè¾¹å½¢ç»˜åˆ¶ç»“æŸlabelå¼¹çª—
å¤šè¾¹å½¢ç»˜åˆ¶ç»“æŸåï¼Œè®°å½•é¼ æ ‡åœ¨å½“å‰ç”»å¸ƒä¸­çš„ä½ç½®ï¼Œåœ¨è®°å½•ä½ç½®ä¸­å¼¹å‡º`label`çª—ä½“è¿›è¡Œå®šä¹‰æ ‡ç­¾ç±»å‹ã€‚
```javascript
// çŸ©å½¢å¼¹å‡ºæ–°å»ºæ ‡ç­¾è¾“å…¥
function promptLabelEditor(rect: Rect) {
  // åˆ›å»ºä¸€ä¸ªinput
  const wrapper = canvas.value!.parentElement! as HTMLElement;
  // åˆ›å»ºä¸€ä¸ªdiv
  const div = document.createElement("div");
  // / è®¾ç½®divçš„æ ·å¼
  div.style.position = "absolute";
  div.style.left = `${startPos.x! - 122}px`;
  div.style.top = `${startPos.y!}px`;
  div.style.background = "white";
  div.style.padding = "4px";
  div.innerHTML = `
      <input type="text" placeholder="è¯·è¾“å…¥Label" style="width:100px"/>
      <button data-action="ok">åˆ›å»º</button>
      <button data-action="cancel">å–æ¶ˆ</button>
    `;

  // æ·»åŠ åˆ°ç”»å¸ƒ
  wrapper.append(div);
  // é€‰ä¸­inputè¾“å…¥æ¡†
  const input = div.querySelector("input") as HTMLInputElement;
  // è®©è¾“å…¥æ¡†è·å–ç„¦ç‚¹
  input.focus();
  // ç§»é™¤ä¸´æ—¶çš„çŸ©å½¢
  const cleanup = () => {
    // ç§»é™¤ä¸´æ—¶çš„çŸ©å½¢
    wrapper.removeChild(div);
    tempRect = null;
  };

  // ç›‘å¬ç‚¹å‡»äº‹ä»¶
  div.addEventListener("click", (e) => {
    const btn = (e.target as HTMLElement).dataset.action;
    if (btn === "ok") {
      const label = input.value.trim();
      if (label) addLabeledRect(rect, label);
      // ç§»é™¤ä¸´æ—¶çš„çŸ©å½¢
      cleanup();
    } else if (btn === "cancel") {
      fCanvas.remove(rect);
      // ç§»é™¤ä¸´æ—¶çš„çŸ©å½¢

      cleanup();
      // æ‰“å¼€åå­—æ§åˆ¶çº¿
      isCrosshair.value = true;
    }
  });
}
```
### ç¬¬åäº”æ­¥ã€æ ¹æ®æ•°æ®æºå›æ˜¾å¤šè¾¹å½¢

> `labelText`ï¼šæ ‡ç­¾å†…å®¹ã€‚
> `id`ï¼šå½“å‰å¯¹è±¡å”¯ä¸€æ ‡è¯†ã€‚
> `circlePoints`ï¼šå¤šè¾¹å½¢çš„ç‚¹ä½è¯¦ç»†ä¿¡æ¯ã€‚

æ•°æ®æ ¼å¼å¦‚ä¸‹ï¼š
```javascript
let imageLabelData: any = reactive([
  {
    imgurl: "http://192.168.80.32:8888/zq.jpeg",
    labelInfo: [] as LabelInfo[],
    labelPolygonInfo: [
      {
        labelText: "10å·çƒå‘˜",
        id: "box_1754903425594",
        circlePoints: [
          [
            { x: 869.9902698710292, y: 2355.0001879442193 },
            { x: 748.9829665322839, y: 2396.397423296948 },
            { x: 586.5784278408101, y: 2323.1561607498134 },
            { x: 280.8757667745062, y: 2233.9928846054736 },
            { x: 233.10972598289615, y: 1921.921418100289 },
            { x: 287.2445722133874, y: 1667.1692005450361 },
            { x: 350.93262660220086, y: 1498.3958564146808 },
            { x: 430.54269458821756, y: 1310.5160959676812 },
            { x: 519.7059707325561, y: 1129.0051409595635 },
            { x: 659.8196903879452, y: 1052.5794756929874 },
            { x: 787.195799165572, y: 969.7850049875302 },
            { x: 793.5646046044533, y: 794.6428554182937 },
            { x: 860.4370617127074, y: 638.6071221657011 },
            { x: 971.8911568931306, y: 597.2098868129724 },
            { x: 1070.607641195791, y: 597.2098868129724 },
            { x: 1166.1397227790112, y: 654.5291357629046 },
            { x: 1217.0901662900615, y: 727.7703983100399 },
            { x: 1201.1681526928583, y: 816.9336744543782 },
            { x: 1201.1681526928583, y: 909.2813533181577 },
            { x: 1185.246139095655, y: 998.4446294624961 },
            { x: 1159.7709173401297, y: 1065.31708657075 },
            { x: 1127.926890145723, y: 1148.1115572762076 },
            { x: 1032.3948085625032, y: 1189.5087926289361 },
            { x: 1000.5507813680963, y: 1224.5372225427836 },
            { x: 994.181975929215, y: 1355.0977340398508 },
            { x: 1022.8416004041812, y: 1482.473842817477 },
            { x: 1035.5792112819438, y: 1603.4811461562226 },
            { x: 1045.132419440266, y: 1673.5380059839174 },
            { x: 1108.8204738290792, y: 1740.4104630921713 },
            { x: 1204.3525554122991, y: 1778.623295725459 },
            { x: 1382.679107700976, y: 1874.155377308679 },
            { x: 1481.395592003637, y: 1899.630599064204 },
            { x: 1624.6937143784667, y: 1899.630599064204 },
            { x: 1720.2257959616863, y: 1953.7654452946954 },
            { x: 1761.6230313144154, y: 2007.9002915251872 },
            { x: 1767.9918367532969, y: 2093.879164950085 },
            { x: 1710.6725878033646, y: 2151.198413900017 },
            { x: 1627.8781170979075, y: 2163.93602477778 },
            { x: 1430.4451484925862, y: 2065.219540475119 },
            { x: 1408.1543294565015, y: 2135.2764003028137 },
            { x: 1382.679107700976, y: 2288.127730835965 },
            { x: 1290.331428837197, y: 2504.6671157579303 },
            { x: 1150.2177091818075, y: 2676.6248626077263 },
            { x: 1086.5296547929943, y: 2791.2633605075907 },
            { x: 1182.0617363762142, y: 2899.533052968573 },
            { x: 1283.9626233983156, y: 3042.831175343403 },
            { x: 1293.515831556638, y: 3131.994451487741 },
            { x: 1137.480098304045, y: 3157.4696732432667 },
            { x: 809.4866182016564, y: 3141.5476596460635 },
            { x: 717.1389393378772, y: 3109.703632451657 },
            { x: 752.1673692517244, y: 3014.171550868437 },
            { x: 717.1389393378772, y: 2915.455066565776 },
            { x: 803.1178127627751, y: 2800.816568665912 },
            { x: 809.4866182016564, y: 2698.9156816438112 },
            { x: 812.6710209210972, y: 2536.511142952337 },
            { x: 847.6994508349445, y: 2450.532269527439 },
          ],
        ],
      },
    ] as any,
  },
  {
    imgurl: "http://192.168.80.32:8888/286_Coax_67480501_SourceImg.jpg",
    labelInfo: [
      {
        labelText: "çŒ«",
        pos1: [0, 0],
        pos2: [500, 500],
        id: "box-1",
      },
    ] as LabelInfo[],
    labelPolygonInfo: [],
  },
]);
```
æ ¹æ®ä»¥ä¸Šæ•°æ®æ ¼å¼ç»˜åˆ¶å¤šè¾¹å½¢ä»£ç ï¼Œé€šè¿‡`forEach`éå†ï¼Œè¿›è¡Œç»˜åˆ¶å¤šä¸ªå¤šè¾¹å½¢ã€‚
```javascript
// ç»˜åˆ¶å¤šè¾¹å½¢æ ‡æ³¨æ¡†
function drawPolygons(labelPolygonInfo: any[], imgObj: any) {
  const imgLeft = imgObj.left!;
  const imgTop = imgObj.top!;
  const imgDisplayWidth = imgObj.getScaledWidth();
  const imgDisplayHeight = imgObj.getScaledHeight();

  const imgBaseLeft = imgLeft - imgDisplayWidth / 2;
  const imgBaseTop = imgTop - imgDisplayHeight / 2;
  labelPolygonInfo.forEach((poly) => {
    const points = poly.circlePoints[0].map((p: any) => ({
      x: imgBaseLeft + p.x * imgObj.scaleX,
      y: imgBaseTop + p.y * imgObj.scaleY,
    }));

    const rgbTempColor: any = stringToColour(poly.labelText);

    const polygon = new Polygon(points, {
      fill: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.01)`,
      stroke: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
      strokeWidth: 1,
      selectable: true,
      objectCaching: false,
      strokeUniform: true,
      evented: true,
      hasControls: false,
      hasBorders: false,
      perPixelTargetFind: true,
      noScaleCache: true,
    });

    const label = new Textbox(poly.labelText, {
      fontSize: 16,
      fill: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
      editable: false,
      selectable: false,
      evented: false,
      originX: "center",
      originY: "center",
    });

    (polygon as any).labelRef = label;
    (polygon as any).boxId = poly.id;
    (label as any).boxId = poly.id;
    (polygon as any).id = poly.id;
    (label as any).id = poly.id;

    // ç»‘å®šå¤šè¾¹å½¢å’Œæ ‡ç­¾çš„å…³ç³»
    (polygon as any).label = label;

    // æ›´æ–°æ ‡ç­¾ä½ç½®å‡½æ•°
    function updateLabelPosition() {
      const center = polygon.getCenterPoint();
      label.set({
        left: center.x,
        top: center.y,
        angle: polygon.angle || 0,
      });
      label.setCoords();
      fCanvas.requestRenderAll();
    }

    // ç»‘å®šæ ‡ç­¾ä½ç½®åŒæ­¥äº‹ä»¶
    polygon.on("moving", updateLabelPosition);
    polygon.on("scaling", updateLabelPosition);
    polygon.on("rotating", updateLabelPosition);

    // ç›‘å¬å¤šè¾¹å½¢ä¿®æ”¹äº‹ä»¶ï¼Œå®æ—¶æ›´æ–°æ•°æ®
    polygon.on("modified", () => {
      console.log("modified", polygon);
      updatePolygonData(polygon);
    });

    // åŒå‡»è¿›å…¥/é€€å‡ºé¡¶ç‚¹ç¼–è¾‘æ¨¡å¼
    polygon.on("mousedblclick", () => {
      if (editingPolygon === polygon) {
        exitVertexEditing(polygon);
      } else {
        if (editingPolygon) exitVertexEditing(editingPolygon);
        enterVertexEditing(polygon);
      }
    });

    // é¼ æ ‡äº‹ä»¶ï¼Œè®¾ç½®æ¿€æ´»å¯¹è±¡å’Œé€‰ä¸­ID
    polygon.on("mousedown", (e) => {
      fCanvas.setActiveObject(polygon);
      fCanvas.requestRenderAll();
      const obj: any = e.target;
      if (obj && obj.boxId) {
        selectedLabelId.value = obj.boxId;
      }
    });

    // è®¾ç½®é»˜è®¤æ ·å¼ï¼ˆä½ ä¹‹å‰ä»£ç é‡Œé‡å¤è®¾ç½®äº†å¤šæ¬¡ï¼Œè¿™é‡Œç»Ÿä¸€æ”¾ï¼‰
    polygon.set({
      fill: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.2)`,
      borderColor: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 1)`,
      stroke: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 1)`,
    });

    // é¼ æ ‡æ‚¬æµ®æ”¹å˜å¡«å……é€æ˜åº¦ï¼Œæå‡äº¤äº’ä½“éªŒ
    polygon.on("mouseover", () => {
      polygon.set(
        "fill",
        `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.2)`
      );
      fCanvas.renderAll();
    });

    polygon.on("mouseout", () => {
      polygon.set(
        "fill",
        `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.01)`
      );
      fCanvas.renderAll();
    });

    // æ·»åŠ å¤šè¾¹å½¢å’Œæ ‡ç­¾åˆ°ç”»å¸ƒ
    fCanvas.add(polygon);
    fCanvas.add(label);

    polygon.setCoords();
    updateLabelPosition();
  });

  fCanvas.requestRenderAll();
}

```

![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/6a6c0da89c8e4de08b9b33fef8106e0a.gif)
### ç¬¬åå…­æ­¥ã€å¯¼å‡ºæ•°æ®æ ¼å¼åŠå…¶æ•°æ®

```javascript
let imageLabelData: any = reactive([
  {
    imgurl: "http://192.168.80.32:8888/zq.jpeg",
    labelInfo: [] as LabelInfo[],
    labelPolygonInfo: [] as any,
  },
  {
    imgurl: "http://192.168.80.32:8888/286_Coax_67480501_SourceImg.jpg",
    labelInfo: [
      {
        labelText: "çŒ«",
        pos1: [0, 0],
        pos2: [500, 500],
        id: "box-1",
      },
    ] as LabelInfo[],
    labelPolygonInfo: [],
  },
]);
```

![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/e2cd113863a74d2eb76b8a1b83340ba3.png)

### å®Œç»“~
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/9563233286c74e0bb969b7134fbb6342.png)


![Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/201433018e044adf93b8b0b1bf4f9425.png)

## ä¼˜åŒ–è¿›è¡Œä¸­~ å…³æ³¨æˆ‘ä¸å®šæ—¶è¿›è¡Œä»£ç ä¼˜åŒ–ä¸åŠŸèƒ½æ·»åŠ 

### ä¼˜åŒ–ä¸€ã€æ·»åŠ æ ‡æ³¨çš„å¤åˆ¶ç²˜è´´åŠŸèƒ½
1. å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥å½“ä½œå‰ªè´´æ¿ï¼Œå°†å¤åˆ¶çš„å†…å®¹èµ‹å€¼ç»™è¯¥å˜é‡ï¼Œé“œé¼“ç²˜è´´æŒ‰é’®è¿›è¡Œæ•°æ®å¤åˆ¶åçš„ç²˜è´´æ“ä½œã€‚

![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/2c8fe1f3173a4ce08a798ca0a0ff6871.png)

```javascript
const clipboard = ref<any>(null); // å­˜å‚¨å¤åˆ¶çš„æ ‡æ³¨
const pastePosition = ref({ x: 0, y: 0 }); // ç²˜è´´çš„åˆå§‹ä½ç½®
```

2. æ·»åŠ å¤åˆ¶ç²˜è´´é€»è¾‘
`copyAnnotation()`ä¸`pasteAnnotation()`æ–¹æ³•å¦‚ä¸‹ï¼š
```javascript

const clipboard = ref<any>(null); // å­˜å‚¨å¤åˆ¶çš„æ ‡æ³¨
const pastePosition = ref({ x: 0, y: 0 }); // ç²˜è´´çš„åˆå§‹ä½ç½®

function copyAnnotation() {
  const activeObj: any = fCanvas.getActiveObject();
  if (!activeObj) {
    return ElMessage.warning("è¯·å…ˆé€‰æ‹©è¦å¤åˆ¶çš„æ ‡æ³¨");
  }

  const id = activeObj.boxId || activeObj.id;

  // æ›´å‡†ç¡®åˆ¤æ–­ç±»å‹
  const isRect = activeObj.type === "rect" || activeObj.type === "group";
  const isPolygon = activeObj.type === "polygon";

  let type: "rect" | "polygon";
  if (isRect) type = "rect";
  else if (isPolygon) type = "polygon";
  else {
    // å¤‡ç”¨åˆ¤æ–­ï¼šçœ‹ id åœ¨å“ªä¸ªæ ‡æ³¨æ•°æ®ä¸­
    const inRect = imageLabelData[currentIndex.value].labelInfo.some(
      (i: any) => i.id === id
    );
    type = inRect ? "rect" : "polygon";
  }

  if (type === "rect") {
    const rectData = imageLabelData[currentIndex.value].labelInfo.find(
      (i: any) => i.id === id
    );
    if (!rectData) {
      return ElMessage.error("æœªæ‰¾åˆ°çŸ©å½¢æ•°æ®");
    }
    clipboard.value = {
      type: "rect",
      data: JSON.parse(JSON.stringify(rectData)),
    };
    ElMessage.success("çŸ©å½¢æ ‡æ³¨å·²å¤åˆ¶");
  } else {
    const polyData = imageLabelData[currentIndex.value].labelPolygonInfo.find(
      (i: any) => i.id === id
    );
    if (!polyData) {
      return ElMessage.error("æœªæ‰¾åˆ°å¤šè¾¹å½¢æ•°æ®");
    }
    clipboard.value = {
      type: "polygon",
      data: JSON.parse(JSON.stringify(polyData)),
    };
    ElMessage.success("å¤šè¾¹å½¢æ ‡æ³¨å·²å¤åˆ¶");
  }
}

// ç²˜è´´çŸ©å½¢æ ‡æ³¨
function pasteRectAnnotation() {
  const rectData = clipboard.value.data;
  const newId = `box_${Date.now()}`;
  // 1. è·å–å›¾ç‰‡å¯¹è±¡
  const img = fCanvas.getObjects("image")[0] as FabricImage;
  if (!img) {
    ElMessage.error("æœªæ‰¾åˆ°å›¾ç‰‡å¯¹è±¡");
    return;
  }

  // 2. è·å–å›¾ç‰‡åœ¨ç”»å¸ƒä¸­çš„å®é™…ä½ç½®å’Œç¼©æ”¾
  const imgDisplayWidth = img.width! * img.scaleX!;
  const imgDisplayHeight = img.height! * img.scaleY!;
  const imgCenterX = img.left!;
  const imgCenterY = img.top!;
  const imgBaseLeft = imgCenterX - imgDisplayWidth / 2;
  const imgBaseTop = imgCenterY - imgDisplayHeight / 2;

  // 3. åæ ‡è½¬æ¢å‡½æ•°ï¼šåŸå§‹å›¾ç‰‡åæ ‡ â†’ ç”»å¸ƒåæ ‡
  const toCanvasPos = (point: [number, number]) => {
    return {
      x: imgBaseLeft + point[0] * img.scaleX!,
      y: imgBaseTop + point[1] * img.scaleY!,
    };
  };

  // 4. è½¬æ¢åæ ‡
  const pos1Canvas = toCanvasPos(rectData.pos1);
  const pos2Canvas = toCanvasPos(rectData.pos2);

  // 5. è®¡ç®—çŸ©å½¢å°ºå¯¸ï¼ˆç”»å¸ƒåæ ‡ç³»ï¼‰
  const width = Math.abs(pos2Canvas.x - pos1Canvas.x);
  const height = Math.abs(pos2Canvas.y - pos1Canvas.y);

  // 6. åˆ›å»ºçŸ©å½¢ï¼ˆä½¿ç”¨è½¬æ¢åçš„åæ ‡ï¼‰

  // 7. æ·»åŠ æ ‡ç­¾ï¼ˆä½¿ç”¨è½¬æ¢åçš„ä½ç½®ï¼‰
  const rgbTempColor: any = stringToColour(rectData.labelText);
  const rect = new Rect({
    left: Math.min(pos1Canvas.x, pos2Canvas.x) + 10,
    top: Math.min(pos1Canvas.y, pos2Canvas.y) + 10,
    width: width,
    height: height,
    fill: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0)`, // å¡«å……é¢œè‰²
    stroke: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`, // è¾¹æ¡†é¢œè‰²
    strokeWidth: 1,
    selectable: true,
    evented: true,
    cornerStrokeWidth: 1,
    strokeUniform: true,
    subTargetCheck: true,
    type: "rect",
  });

  const tb = new Textbox(rectData.labelText, {
    left: Math.min(pos1Canvas.x, pos2Canvas.x) + 10,
    top: Math.min(pos1Canvas.y, pos2Canvas.y) + 10,
    fontSize: 26,
    fill: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
    editable: false,
    borderColor: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
    selectable: false,
    evented: false,
  });

  // 8. è‡ªå®šä¹‰æ§åˆ¶ç‚¹
  rect.controls = createCustomControls();

  // 9. åˆ›å»ºç»„
  // const group = new Group([rect], {
  //   selectable: true,
  //   evented: true,
  //   subTargetCheck: true,
  // });
  // group.controls = createCustomControls();

  // (group as any).boxId = newId;
  // (group as any).id = newId;
  (rect as any).boxId = newId;
  (tb as any).boxId = newId;
  (rect as any).id = newId;
  (tb as any).id = newId;

  // 10. æ·»åŠ åˆ°ç”»å¸ƒ
  // fCanvas.add(group);
  fCanvas.add(rect);
  fCanvas.add(tb);

  // 11. æ·»åŠ åˆ°æ•°æ®æºï¼ˆå­˜å‚¨åŸå§‹å›¾ç‰‡åæ ‡ï¼‰
  imageLabelData[currentIndex.value].labelInfo.push({
    ...rectData,
    id: newId,
    pos1: [rectData.pos1[0] + 10, rectData.pos1[1] + 10], // ä¿æŒåŸå§‹å›¾ç‰‡åæ ‡
    pos2: [rectData.pos2[0] + 10, rectData.pos2[1] + 10], // ä¿æŒåŸå§‹å›¾ç‰‡åæ ‡
  });

  // 12. è®¾ç½®äº‹ä»¶ç›‘å¬
  rect.on("moving", () => {
    const boundingBox = rect.getBoundingRect();
    tb.set({
      left: boundingBox.left,
      top: boundingBox.top,
    });
  });

  rect.on("mousedown", (e) => {
    const obj: any = e.target;
    if (obj && obj.boxId) {
      selectedLabelId.value = obj.boxId;
    }
  });

  rect.on("mousedown", (e) => {
    // é€‰ä¸­å½“å‰ rectSmall å¯¹è±¡
    fCanvas.setActiveObject(rect);
    // é‡æ–°æ¸²å›¾â€”â€”å¿…è¦ï¼Œå¦åˆ™é€‰ä¸­æ¡†ä¸ä¼šå‡ºç°
    fCanvas.requestRenderAll();
    console.log("å·²é€‰ä¸­å°çŸ©å½¢", rect);
    const obj: any = e.target as any;
    if (obj && obj.boxId) {
      selectedLabelId.value = obj.boxId;
    }
  });

  rect.on("scaling", () => {
    const boundingBox = rect.getBoundingRect();
    tb.set({
      left: boundingBox.left,
      top: boundingBox.top,
    });
  });

  ElMessage.success("çŸ©å½¢æ ‡æ³¨å·²ç²˜è´´");
}

// ç²˜è´´å¤šè¾¹å½¢æ ‡æ³¨
function pastePolygonAnnotation() {
  const polygonData = clipboard.value.data;
  const newId = `box_${Date.now()}`;

  // 1. è·å–å›¾ç‰‡å¯¹è±¡
  const img = fCanvas.getObjects("image")[0] as FabricImage;
  if (!img) {
    ElMessage.error("æœªæ‰¾åˆ°å›¾ç‰‡å¯¹è±¡");
    return;
  }

  // 2. åæ ‡è½¬æ¢å‡½æ•°ï¼šåŸå§‹å›¾ç‰‡åæ ‡ â†’ ç”»å¸ƒåæ ‡
  const toCanvasPos = (point: { x: number; y: number }) => {
    const imgDisplayWidth = img.width! * img.scaleX!;
    const imgDisplayHeight = img.height! * img.scaleY!;
    const imgBaseLeft = img.left! - imgDisplayWidth / 2;
    const imgBaseTop = img.top! - imgDisplayHeight / 2;
    return {
      x: imgBaseLeft + point.x * img.scaleX!,
      y: imgBaseTop + point.y * img.scaleY!,
    };
  };

  // 3. åç§»é‡ï¼ˆå³ä¸‹ 10pxï¼‰
  const offsetX = 10;
  const offsetY = 10;

  // 4. æŠŠåŸå§‹å›¾ç‰‡åæ ‡è½¬æ¢åˆ°ç”»å¸ƒåæ ‡ï¼Œå¹¶åŠ åç§»
  const pointsCanvas = polygonData.circlePoints.map((p: any) => {
    const pos = toCanvasPos(p);
    return { x: pos.x + offsetX, y: pos.y + offsetY };
  });

  // 5. åˆ›å»ºå¤šè¾¹å½¢
  const rgbTempColor: any = stringToColour(polygonData.labelText);
  const polygon = new Polygon(pointsCanvas, {
    fill: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.01)`,
    stroke: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
    strokeWidth: 1,
    selectable: true,
    objectCaching: false,
    strokeUniform: true,
    evented: true,
    hasControls: false,
    hasBorders: false,
    perPixelTargetFind: true,
    noScaleCache: true,
    type: "polygon",
  });

  // 6. åˆ›å»ºæ ‡ç­¾
  const label = new Textbox(polygonData.labelText, {
    fontSize: 16,
    fill: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
    editable: false,
    selectable: false,
    evented: false,
    originX: "center",
    originY: "center",
  });

  // å…³é”®ä¿®æ”¹ï¼šå°†æ–‡æœ¬æ ‡ç­¾ä¸å¤šè¾¹å½¢å…³è”
  (polygon as any).label = label;

  polygon.set({ id: newId });
  label.set({ id: newId });

  // 7. æ·»åŠ åˆ°ç”»å¸ƒ
  fCanvas.add(polygon);
  fCanvas.add(label);

  // 8. æ›´æ–°æ ‡ç­¾ä½ç½®ï¼ˆç”¨å¤šè¾¹å½¢ä¸­å¿ƒç‚¹ï¼‰
  const center = polygon.getCenterPoint();
  label.set({
    left: center.x,
    top: center.y,
  });

  // 9. æ·»åŠ åˆ°æ•°æ®æºï¼ˆå­˜å‚¨åŸå§‹å›¾ç‰‡åæ ‡ï¼ŒåŠ åŒæ ·åç§»ï¼‰
  imageLabelData[currentIndex.value].labelPolygonInfo.push({
    ...polygonData,
    id: newId,
    circlePoints: polygonData.circlePoints.map((p: any) => ({
      x: p.x + offsetX,
      y: p.y + offsetY,
    })),
  });

  // 10. äº‹ä»¶ç›‘å¬
  polygon.on("modified", () => {
    updatePolygonData(polygon);
  });

  polygon.on("mousedblclick", () => {
    if (editingPolygon === polygon) {
      exitVertexEditing(polygon);
    } else {
      if (editingPolygon) exitVertexEditing(editingPolygon);
      enterVertexEditing(polygon);
    }
  });

  polygon.on("moving", () => {
    const center = polygon.getCenterPoint();
    label.set({
      left: center.x,
      top: center.y,
    });
    fCanvas.requestRenderAll();
  });

  polygon.on("scaling", () => {
    const center = polygon.getCenterPoint();
    label.set({
      left: center.x,
      top: center.y,
    });
    fCanvas.requestRenderAll();
  });

  polygon.on("mousedown", (e) => {
    fCanvas.setActiveObject(polygon);
    fCanvas.requestRenderAll();
    const obj: any = e.target;
    if (obj && obj.id) {
      selectedLabelId.value = obj.id;
    }
  });

  // 11. æ›´æ–°ä¸‹æ¬¡ç²˜è´´çš„åˆå§‹ä½ç½®
  pastePosition.value = {
    x: pastePosition.value.x + offsetX,
    y: pastePosition.value.y + offsetY,
  };

  ElMessage.success("å¤šè¾¹å½¢æ ‡æ³¨å·²ç²˜è´´ï¼ˆå³ä¸‹åç§»10pxï¼‰");
}

function pasteAnnotation() {
  if (!clipboard.value) {
    ElMessage.warning("å‰ªè´´æ¿ä¸­æ²¡æœ‰æ ‡æ³¨");
    return;
  }

  // è®°å½•ç²˜è´´ä½ç½®ï¼ˆç”»å¸ƒä¸­å¿ƒï¼‰
  pastePosition.value = {
    x: fCanvas.getWidth() / 2,
    y: fCanvas.getHeight() / 2,
  };
  console.log("ç²˜è´´ä½ç½®:", clipboard.value.type);
  if (clipboard.value.type === "rect") {
    pasteRectAnnotation();
  } else if (clipboard.value.type === "polygon") {
    pastePolygonAnnotation();
  }
}
```
æ•ˆæœï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/a1e5cd4531eb46bfaced0665d833eb47.gif)
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/746b7710b8954dd6af20c2944adf088d.png)

### ä¼˜åŒ–äºŒã€æ·»åŠ ä¸è§„åˆ™å¤šè¾¹å½¢è§„åˆ™å¤„ç†
æœ‰çš„å®¢æˆ·åœ¨è¿›è¡Œåˆ›å»ºå¤šè¾¹å½¢çš„æ—¶å€™ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸è§„åˆ™çš„å¤šè¾¹å½¢ï¼Œæ·»åŠ ä¸€ä¸ªé…ç½®æ–¹æ³•ï¼Œæ˜¯å¦è§„åˆ™åŒ–å¤šè¾¹å½¢å¼€å…³ï¼Œå¦‚æœæ‰“å¼€çŠ¶æ€ï¼Œä¼šå°†åœ¨åˆ›å»ºå¤šè¾¹å½¢åè¿›è¡Œè‡ªåŠ¨è§„åˆ™åŒ–ï¼Œå¦‚ä¸‹å›¾ï¼Œå°†äº¤å‰å¤šè¾¹å½¢ç»è¿‡ä¸­å¿ƒè§’åº¦å¯¹æ¯”æ’åºåè§„åˆ™åŒ–å¤šè¾¹å½¢ã€‚
ä¸‹å›¾ä¸­ï¼Œå·¦è¾¹æ˜¯ä¸è§„åˆ™å¤šè¾¹å½¢ï¼Œå³è¾¹æ˜¯è§„åˆ™åŒ–åçš„å¤šè¾¹å½¢ï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/5b2d8a0967634a5383c3e11a85d78c35.png)
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/5cbe25cc434f44cea1122600eff3e210.png)
è§„åˆ™å¤šè¾¹å½¢æµ‹è¯•æ²¡æœ‰å½±å“ï¼š

![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·ã€ä¸‹ã€‘](https://i-blog.csdnimg.cn/direct/aa63a7e1929a423ea029aa6644438de3.png)
å®ç°æ€è·¯ï¼š

> æ‰¾å‡ºæ‰€æœ‰ç‚¹çš„ä¸­å¿ƒç‚¹ä¹Ÿå°±æ˜¯ã€è´¨å¿ƒ/å¹³å‡åæ ‡ã€‘ï¼Œè®¡ç®—æ¯ä¸ªç‚¹ç›¸å¯¹äºä¸­å¿ƒç‚¹çš„è§’åº¦ã€atan2(y - cy, x - cx)ã€‘ï¼ŒæŒ‰ç…§è§’åº¦ä»å°åˆ°å¤§æ’åºï¼Œç”¨æ’åºåçš„ç‚¹æ¥ç»˜åˆ¶å¤šè¾¹å½¢ï¼Œå°±ä¼šä½¿è§„åˆ™ä¸äº¤å‰çš„å½¢çŠ¶ã€‚

å®ç°æ–¹æ³•ï¼š
```typescript
/**
 *
 * @param sortPointsToPolygon
 * 1. æ‰¾å‡ºæ‰€æœ‰ç‚¹çš„ä¸­å¿ƒç‚¹ï¼ˆè´¨å¿ƒ / å¹³å‡åæ ‡ï¼‰ã€‚
 * 2. è®¡ç®—æ¯ä¸ªç‚¹ç›¸å¯¹äºä¸­å¿ƒç‚¹çš„è§’åº¦ atan2(y - cy, x - cx)ã€‚
 * 3. æŒ‰è§’åº¦ä»å°åˆ°å¤§æ’åºã€‚
 * 4. ç”¨æ’åºåçš„ç‚¹æ¥ç»˜åˆ¶å¤šè¾¹å½¢ï¼Œå°±ä¼šæ˜¯è§„åˆ™ï¼ˆä¸äº¤å‰ï¼‰çš„å½¢çŠ¶ã€‚
 */
function sortPointsToPolygon(points: { x: number; y: number }[]) {
  // 1. è®¡ç®—è´¨å¿ƒ
  const center = points.reduce(
    (acc, p) => {
      acc.x += p.x;
      acc.y += p.y;
      return acc;
    },
    { x: 0, y: 0 }
  );
  center.x /= points.length;
  center.y /= points.length;

  // 2. è®¡ç®—è§’åº¦å¹¶æ’åº
  return points
    .map((p) => ({
      ...p,
      angle: Math.atan2(p.y - center.y, p.x - center.x),
    }))
    .sort((a, b) => a.angle - b.angle)
    .map(({ x, y }) => ({ x, y })); // è¿”å›æ’åºåçš„ç‚¹
}
```
æ ¹æ®æŒ‰é’®é…ç½®æ˜¯å¦è§„åˆ™åŒ–
```typescript
<div class="menu-item" style="text-align: center">
  <el-switch
    style="margin-left: -15px"
    v-model="regularPolygon"
    active-color="#9AC8E0"
    inactive-color="#E8E8E8"
  />
  <div class="menu-item-text">æ˜¯å¦è§„åˆ™å¤šè¾¹å½¢</div>
</div>
```

åœ¨ç»“æŸå¤šè¾¹å½¢ç»˜åˆ¶å’Œå›¾ç‰‡åˆå§‹åŒ–ç»˜åˆ¶çš„æ—¶å€™ï¼Œè¿›è¡Œåˆ¤æ–­æ˜¯å¦è§„åˆ™åŒ–ï¼Œå¦‚æœè§„åˆ™åŒ–åˆ™è°ƒç”¨`sortPointsToPolygon`æ–¹æ³•è§„åˆ™åŒ–ã€‚
`finalizePolygon`ä»£ç ä¿®æ”¹ï¼š
```typescript
// 4. å°†æ¯ä¸ªç‚¹è½¬æ¢åˆ°ç”»å¸ƒç»å¯¹åæ ‡
  const absPoints = pts.map((p) => {
    const relative = {
      x: p.x - polyTemp.pathOffset.x,
      y: p.y - polyTemp.pathOffset.y,
    };
    return util.transformPoint(relative, matrix); // :contentReference[oaicite:2]{index=2}
  });
  // sortPointsToPolygon(poly.circlePoints)
  // console.log("------------", absPoints);
  let tempPointArr: any = absPoints;
  if (regularPolygon.value) {
    tempPointArr = sortPointsToPolygon(absPoints);
  }
  // 5. åˆ›å»ºçœŸæ­£ç”¨äºæ ‡æ³¨çš„å¤šè¾¹å½¢å¯¹è±¡
  const finalPoly = new Polygon(tempPointArr, {
    stroke: "red",
    strokeWidth: 1,
    fill: `rgba(149, 204, 100,0.2)`,
    objectCaching: false,
    selectable: true,
    evented: true,
    hasControls: false, // åˆå§‹ä¸æ˜¾ç¤ºæ§åˆ¶ç‚¹
    hasBorders: false,
    strokeUniform: true,
    perPixelTargetFind: true,
    noScaleCache: true,
  });
```
åˆå§‹åŒ–ç»˜åˆ¶çš„æ—¶å€™è°ƒç”¨`sortPointsToPolygon`æ–¹æ³•ï¼Œä¿®æ”¹`drawPolygons`æ–¹æ³•ï¼š

```typescript
  labelPolygonInfo.forEach((poly) => {
    let tempPointArr = poly.circlePoints;
    if (regularPolygon.value) {
      tempPointArr = sortPointsToPolygon(poly.circlePoints);
    }
    const points = tempPointArr.map((p: any) => ({
      x: imgBaseLeft + p.x * imgObj.scaleX,
      y: imgBaseTop + p.y * imgObj.scaleY,
    }));

    const rgbTempColor: any = stringToColour(poly.labelText);

    const polygon = new Polygon(points, {
      fill: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.01)`,
      stroke: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
      strokeWidth: 1,
      selectable: true,
      objectCaching: false,
      strokeUniform: true,
      evented: true,
      hasControls: false,
      hasBorders: false,
      perPixelTargetFind: true,
      noScaleCache: true,
    });

    const label = new Textbox(poly.labelText, {
      fontSize: 16,
      fill: `rgb(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b})`,
      editable: false,
      selectable: false,
      evented: false,
      originX: "center",
      originY: "center",
    });

    (polygon as any).labelRef = label;
    (polygon as any).boxId = poly.id;
    (label as any).boxId = poly.id;
    (polygon as any).id = poly.id;
    (label as any).id = poly.id;

    // ç»‘å®šå¤šè¾¹å½¢å’Œæ ‡ç­¾çš„å…³ç³»
    (polygon as any).label = label;

    // æ›´æ–°æ ‡ç­¾ä½ç½®å‡½æ•°
    function updateLabelPosition() {
      const center = polygon.getCenterPoint();
      label.set({
        left: center.x,
        top: center.y,
        angle: polygon.angle || 0,
      });
      label.setCoords();
      fCanvas.requestRenderAll();
    }

    // ç»‘å®šæ ‡ç­¾ä½ç½®åŒæ­¥äº‹ä»¶
    polygon.on("moving", updateLabelPosition);
    polygon.on("scaling", updateLabelPosition);
    polygon.on("rotating", updateLabelPosition);

    // ç›‘å¬å¤šè¾¹å½¢ä¿®æ”¹äº‹ä»¶ï¼Œå®æ—¶æ›´æ–°æ•°æ®
    polygon.on("modified", () => {
      console.log("modified", polygon);
      updatePolygonData(polygon);
    });

    // åŒå‡»è¿›å…¥/é€€å‡ºé¡¶ç‚¹ç¼–è¾‘æ¨¡å¼
    polygon.on("mousedblclick", () => {
      if (editingPolygon === polygon) {
        exitVertexEditing(polygon);
      } else {
        if (editingPolygon) exitVertexEditing(editingPolygon);
        enterVertexEditing(polygon);
      }
    });

    // é¼ æ ‡äº‹ä»¶ï¼Œè®¾ç½®æ¿€æ´»å¯¹è±¡å’Œé€‰ä¸­ID
    polygon.on("mousedown", (e) => {
      fCanvas.setActiveObject(polygon);
      fCanvas.requestRenderAll();
      const obj: any = e.target;
      if (obj && obj.boxId) {
        selectedLabelId.value = obj.boxId;
      }
    });

    // è®¾ç½®é»˜è®¤æ ·å¼ï¼ˆä½ ä¹‹å‰ä»£ç é‡Œé‡å¤è®¾ç½®äº†å¤šæ¬¡ï¼Œè¿™é‡Œç»Ÿä¸€æ”¾ï¼‰
    polygon.set({
      fill: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.2)`,
      borderColor: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 1)`,
      stroke: `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 1)`,
    });

    // é¼ æ ‡æ‚¬æµ®æ”¹å˜å¡«å……é€æ˜åº¦ï¼Œæå‡äº¤äº’ä½“éªŒ
    polygon.on("mouseover", () => {
      polygon.set(
        "fill",
        `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.2)`
      );
      fCanvas.renderAll();
    });

    polygon.on("mouseout", () => {
      polygon.set(
        "fill",
        `rgba(${rgbTempColor.r}, ${rgbTempColor.g}, ${rgbTempColor.b}, 0.01)`
      );
      fCanvas.renderAll();
    });

    // æ·»åŠ å¤šè¾¹å½¢å’Œæ ‡ç­¾åˆ°ç”»å¸ƒ
    fCanvas.add(polygon);
    fCanvas.add(label);

    polygon.setCoords();
    updateLabelPosition();
  });

```
æ•ˆæœï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/d69280ec10154d03aafb935a7280f06b.gif)

### ä¼˜åŒ–ä¸‰ã€å¤šè¾¹å½¢åˆ›å»ºäº¤äº’ä¼˜åŒ–ã€é˜²å‘†å¤„ç†ã€‘
ç¬¬ä¸€ç‰ˆæœ¬çš„åˆ›å»ºå¤šè¾¹å½¢ä¸ºåˆ›å»ºè”ä¸´æ—¶ç‚¹ä¸´æ—¶çº¿éå¸¸æ­»æ¿ï¼Œç»è¿‡æ€è€ƒå€Ÿé‰´å…¶ä»–å¤šè¾¹å½¢çš„æ ‡æ³¨ï¼Œé‡‡ç”¨ä¸´æ—¶å¤šè¾¹å½¢å’Œæ ¹æ®æœ€åä¸€ä¸ªç‚¹çš„é¼ æ ‡ç§»åŠ¨ä½ç½®åŠ¨æ€ä¸´æ—¶å¤šè¾¹å½¢ï¼Œé€šè¿‡æŒ‰`esc`å–æ¶ˆåˆ›å»ºå¤šè¾¹å½¢ã€‚
ä¼˜åŒ–ä»£ç ä¸º`setupEventListeners()`æ–¹æ³•ä¸­çš„é¼ æ ‡æŒ‰ä¸‹åŠå…¶`esc`é”®ç›‘å¬ã€‚

```typescript

  // ç›‘å¬é”®ç›˜æŒ‰ä¸‹
  window.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && drawingPolygon.value) {
      drawingPolygon.value = false;
      currentPolygonPoints = [];
      clearTempDraw(); // é€€å‡ºç»˜åˆ¶æ—¶æ¸…é™¤æ‰€æœ‰ä¸´æ—¶ç‚¹
    }
  });

  // ç›‘å¬é¼ æ ‡å³é”®
  fCanvas.on("mouse:down", (opt) => {
    const e = opt.e as MouseEvent;
    if (e.button === 2 && drawingPolygon.value) {
      // é¼ æ ‡å³é”®å–æ¶ˆ
      cancelPolygonDrawing();
    }
  });
  // é¼ æ ‡æŒ‰ä¸‹
  fCanvas.on("mouse:down", (opt) => {
    const obj = opt.target as any;
    const target = opt.target as any;
    const e = opt.e as MouseEvent;
    if (!opt.target) {
      // ç”¨æˆ·ç‚¹å‡»ç”»å¸ƒç©ºç™½å¤„
      fCanvas.discardActiveObject();
      fCanvas.requestRenderAll();
      selectedLabelId.value = null; // æ¸…ç©ºé«˜äº®
    } else {
      const obj = opt.target as any;
      if (obj.boxId) {
        selectedLabelId.value = obj.boxId; // ç‚¹å‡»çŸ©å½¢æ¡†
      }
    }
    if (!drawingPolygon.value) return;

    const pointer = fCanvas.getPointer(e);
    const point = { x: pointer.x, y: pointer.y };

    // ç¬¬ä¸€ä¸ªç‚¹ç‚¹å‡»æ—¶å¼€å§‹ç»˜åˆ¶
    if (currentPolygonPoints.length === 0) {
      currentPolygonPoints.push(point);
      addTempCircle(point);
      return;
    }

    // å¦‚æœç‚¹å‡»ç¬¬ä¸€ä¸ªç‚¹é™„è¿‘ä¸”ç‚¹æ•° >=3ï¼Œé—­åˆå¤šè¾¹å½¢
    const first = currentPolygonPoints[0];
    if (currentPolygonPoints.length >= 3 && distance(point, first) < 10) {
      finalizePolygon();
      return;
    }

    // å¦åˆ™æ­£å¸¸æ·»åŠ æ–°ç‚¹
    currentPolygonPoints.push(point);
    addTempCircle(point);
    addTempLine();
  });
```
å°†æ·»åŠ ä¸´æ—¶çŸ©å½¢æŠ½å‡ºä¸ºå•ç‹¬æ–¹æ³•å¦‚ä¸‹ï¼š

```typescript
function addTempCircle(point: any) {
  const circle = new Circle({
    left: point.x,
    top: point.y,
    radius: 3,
    fill: "red",
    selectable: false,
    originX: "center",
    originY: "center",
  });
  fCanvas.add(circle);
  tempCirclePoints.push(circle);
}

function addTempLine() {
  const len = currentPolygonPoints.length;
  if (len < 2) return;
  const last = currentPolygonPoints[len - 2];
  const curr = currentPolygonPoints[len - 1];
  const line = new Line([last.x, last.y, curr.x, curr.y], {
    stroke: "red",
    strokeWidth: 1,
    selectable: false,
  });
  fCanvas.add(line);
  tempLinePoints.push(line);
}

function distance(p1: any, p2: any) {
  const dx = p1.x - p2.x;
  const dy = p1.y - p2.y;
  return Math.sqrt(dx * dx + dy * dy);
}
```
æ•ˆæœï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/c372a2ef92af42ec97e9a8d30a707dee.gif)
### ä¼˜åŒ–å››ã€æ·»åŠ æ ‡æ³¨ç»“æœå¯¼å‡ºå›¾ç‰‡åŠŸèƒ½

æ ¹æ®IDæ‰¾åˆ°å¯¹åº”çš„æ ‡æ³¨ï¼Œç„¶åè¿åŒæ ‡æ³¨åŒºåŸŸä¸èƒŒæ™¯å›¾ä¸€å¹¶å‰ªåˆ‡ä¿å­˜ä¸ºå›¾ç‰‡ã€‚

```typescript
<el-button
class="delete-btn"
 type="primary"
 @click="exportDefect(item.id)"
 >å¯¼å‡º</el-button>
```
ç¼–è¾‘`exportDefect()`æ–¹æ³•é€»è¾‘

```typescript
//---------------å¯¼å‡ºæ ‡æ³¨ç‘•ç–µå¼€å§‹-------------------
function exportDefect(defectId: string | number) {
  const target = fCanvas.getObjects().find((obj: any) => {
    const isWanted =
      obj.type === "rect" || obj.type === "polygon" || obj.type === "group";
    const sameId = obj.boxId === defectId || obj.id === defectId;
    return isWanted && sameId;
  }) as any;

  if (!target) {
    console.error("æœªæ‰¾åˆ°å¯¹åº”çš„ç¼ºé™·æ ‡æ³¨");
    return;
  }

  const measureObj =
    target.type === "group" && (target as any).mainRect
      ? (target as any).mainRect
      : target;

  // ç¡®ä¿åæ ‡æ›´æ–°
  measureObj.setCoords();

  // 1) åœ¨â€œç”»å¸ƒåæ ‡ç³»â€ä¸‹è®¡ç®—åŒ…å›´ç›’
  const br = measureObj.getBoundingRect(true, true);
  const PAD = 2; // å®‰å…¨è¾¹è·ï¼Œé¿å…è¾¹ç¼˜è¢«æˆªæ–­
  const left = br.left - PAD;
  const top = br.top - PAD;
  const width = br.width + PAD * 2;
  const height = br.height + PAD * 2;

  // 2) å°†ç”»å¸ƒåæ ‡å˜æ¢åˆ° viewportï¼ˆå½“å‰å±å¹•/æ¸²æŸ“ï¼‰åæ ‡
  //    viewportTransform æ ¼å¼ä¸º [a, b, c, d, e, f]ï¼Œå˜æ¢è§„åˆ™ï¼š
  //    x' = a * x + c * y + e
  //    y' = b * x + d * y + f
  const vpt = fCanvas.viewportTransform || [1, 0, 0, 1, 0, 0];
  const transformPoint = (pt: { x: number; y: number }, t: number[]) => ({
    x: t[0] * pt.x + t[2] * pt.y + t[4],
    y: t[1] * pt.x + t[3] * pt.y + t[5],
  });

  const tl = transformPoint({ x: left, y: top }, vpt);
  const brP = transformPoint({ x: left + width, y: top + height }, vpt);

  const leftV = Math.floor(tl.x);
  const topV = Math.floor(tl.y);
  const widthV = Math.ceil(brP.x - tl.x);
  const heightV = Math.ceil(brP.y - tl.y);

  // fCanvas.renderAll();

  // 3) ç”¨å˜æ¢åçš„ viewport åæ ‡è°ƒç”¨ toDataURLï¼ˆè¿™æ · toDataURL å†…éƒ¨çš„ viewport åº”ä¸æˆ‘ä»¬ä¸€è‡´ï¼‰
  const dataURL = fCanvas.toDataURL({
    format: "png",
    quality: 1,
    left: leftV,
    top: topV,
    width: widthV,
    height: heightV,
    multiplier: 3, // å€ç‡æ¸²æŸ“ï¼Œå€¼è¶Šå¤§å¯¼å‡ºè¶Šæ¸…æ™°
    enableRetinaScaling: false, // é¿å…å’Œè®¾å¤‡ DPR å†²çª
  });

  downloadImage(dataURL, `defect-${defectId}-${Date.now()}.png`);
}

// ä¸‹è½½å›¾ç‰‡
function downloadImage(dataURL: string, filename: string) {
  const link = document.createElement("a");
  link.download = filename;
  link.href = dataURL;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
// --------------å¯¼å‡ºæ ‡æ³¨ç‘•ç–µç»“æŸ-------------------
```

æ•ˆæœï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/a95c7454256f45fd9b7c60709dbb8bc4.gif)

### ä¼˜åŒ–äº”ã€åˆ›å»ºå¤šè¾¹å½¢æ–¹å¼ä¼˜åŒ–
æ ‡æ³¨å‘ç°ï¼Œå¤šè¾¹å½¢çš„ç‚¹çº¿æ ‡æ³¨è¿‡äºæ­»æ¿ï¼Œå°†å…¶ä¼˜åŒ–ä¸ºåŠ¨æ€ä¸´æ—¶å¤šè¾¹å½¢åˆ›å»ºï¼Œåˆ›å»ºå¤šè¾¹å½¢ä¸´æ—¶ç‚¹çº¿æ”¹ä¸ºä¸´æ—¶å¤šè¾¹å½¢ï¼Œä¸”ä¸´æ—¶å¤šè¾¹å½¢æœ€åä¸€ä¸ªç‚¹è·Ÿç€é¼ æ ‡å˜æ¢ï¼Œåˆ¤æ–­ç‚¹æ•°`>2`å¦‚æœ`>2`åˆ™è¿›è¡Œåˆ›å»ºä¸´æ—¶å¤šè¾¹å½¢ã€‚
```typescript
// ä½¿ç”¨è‡ªå®šä¹‰çš„èŠ‚æµå‡½æ•°
  fCanvas.on("mouse:move", function (opt) {
    // ä½ çš„ mouse:move äº‹ä»¶å¤„ç†é€»è¾‘
    const pointerA: any = fCanvas.getPointer(opt.e);
    console.log(pointerA.x, pointerA.y);
    const e = opt.e as MouseEvent;
    startPos.x = e.clientX;
    startPos.y = e.clientY;
    // ç»˜åˆ¶ä¸­
    if (drawing && tempRect) {
      // è·å–é¼ æ ‡ä½ç½®
      const p = fCanvas.getPointer(e);
      // è®¾ç½®çŸ©å½¢çš„å®½é«˜å’Œä½ç½®
      tempRect.set({
        width: Math.abs(p.x - startX),
        height: Math.abs(p.y - startY),
        left: p.x < startX ? p.x : startX,
        top: p.y < startY ? p.y : startY,
      });
      // è®¾ç½®çŸ©å½¢çš„åæ ‡
      tempRect.setCoords();
      // è¯·æ±‚é‡æ–°æ¸²æŸ“
      console.log("é˜²æŠ–å¤„ç†");
      fCanvas.requestRenderAll();
      // fCanvas.renderAll();
    } else if (isPanning) {
      // æ‹–æ‹½ä¸­
      fCanvas.relativePan(new Point(e.clientX - lastX, e.clientY - lastY));
      // è®°å½•æœ€åä½ç½®
      lastX = e.clientX;
      lastY = e.clientY;
    }
```
æ•ˆæœï¼š
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/26e828d4623747b0b4c6b42877eeda41.gif)
### ä¼˜åŒ–å…­ã€åˆ›å»ºæ ‡æ³¨æ¡†çš„æ ‡ç­¾æ–¹å¼ä¼˜åŒ–
ç”±ä»¥å¾€çš„è¾“å…¥æ ‡ç­¾çš„æ–¹å¼ï¼Œæ”¹ä¸ºå¯ä»¥è‡ªè¡Œåˆ›å»ºå¯¼å…¥çš„ä¸‹æ‹‰é€‰æ‹©æ–¹å¼è¿›è¡Œä¸‹æ‹‰é€‰æ‹©æ ‡æ³¨ã€‚
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/35f8ea9cfc5943ada00d13bd479c70ac.gif)
### ä¼˜åŒ–ä¸ƒã€è§£å†³è¶…å¤§å›¾æ”¾å¤§åç»˜åˆ¶å¡é¡¿é—®é¢˜
ç”±äºåœ¨å®Œæˆæ ‡æ³¨åŠŸèƒ½çš„æ—¶å€™ï¼Œè¿›è¡Œäº†å¤§é‡ç”»å¸ƒä»¥åŠç³»ç»Ÿäº‹ä»¶çš„ç›‘å¬ï¼Œæ‰€ä»¥æ¯æ¬¡åˆ‡æ¢å›¾ç‰‡å’Œè¿›å…¥éƒ½éœ€è¦è¿›è¡Œé”€æ¯ç›‘å¬çš„äº‹ä»¶ã€‚ä¿è¯çŸ©å½¢å¤šè¾¹å½¢çš„æµç•…åº¦ã€‚æ³¨æ„ï¼šå½“å›¾ç‰‡æ”¾å¤§å¾ˆå¤šå€çš„æ—¶å€™ï¼Œ`fabric.js`ä¼šæ¨¡æ‹ŸçœŸå®åƒç´ ä¹Ÿä¼šå¯¼è‡´å¡é¡¿é—®é¢˜ï¼Œä¸ºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°‘ç”¨`fCanvas.renderAll();`å¤šç”¨`fCanvas.requestRenderAll();`
è§£é‡Šï¼š

åœ¨ `Fabric.js `ä¸­ï¼Œ`fCanvas.requestRenderAll()`å’Œ`fCanvas.renderAll()`çš„ä¸»è¦åŒºåˆ«åœ¨äºæ¸²æŸ“æ–¹å¼ï¼š

æ¸²æŸ“æ–¹å¼
> `â€ŒrenderAll()â€Œ`ï¼šåŒæ­¥æ¸²æŸ“ç”»å¸ƒï¼Œç«‹å³é‡æ–°ç»˜åˆ¶æ‰€æœ‰å†…å®¹ã€‚é€‚ç”¨äºéœ€è¦ç«‹å³æ›´æ–°ç”»å¸ƒçš„åœºæ™¯ï¼Œä¾‹å¦‚æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹å¯¹è±¡æ—¶ã€‚ â€Œ
> `â€ŒrequestRenderAll()â€Œ`ï¼šå¼‚æ­¥æ¸²æŸ“ï¼Œå°†æ¸²æŸ“ä»»åŠ¡å®‰æ’åˆ°æµè§ˆå™¨çš„ä¸‹ä¸€å¸§é‡ç»˜å‘¨æœŸã€‚é€‚ç”¨äºé¢‘ç¹æ›´æ–°ç”»å¸ƒçš„åœºæ™¯ï¼Œå¯å‡å°‘é‡å¤æ¸²æŸ“æ¬¡æ•°ï¼Œæå‡æ€§èƒ½ã€‚

 â€Œ
ä½¿ç”¨åœºæ™¯
> `â€ŒrenderAll()â€Œ`ï¼šå½“å¯¹è±¡çŠ¶æ€å˜åŒ–éœ€è¦ç«‹å³åæ˜ åˆ°ç”¨æˆ·ç•Œé¢æ—¶ï¼ˆå¦‚å®æ—¶ç¼–è¾‘ï¼‰ï¼Œåº”ä¼˜å…ˆä½¿ç”¨ã€‚ â€Œ
> `â€ŒrequestRenderAll()â€Œ`ï¼šåœ¨é«˜é¢‘æ›´æ–°ï¼ˆå¦‚åŠ¨ç”»ã€è¿ç»­æ“ä½œï¼‰æ—¶ï¼Œå»ºè®®ä½¿ç”¨ä»¥é¿å…æ€§èƒ½é—®é¢˜ã€‚ â€Œ

æ€§èƒ½ä¼˜åŒ–

> `requestRenderAll()`é€šè¿‡å»¶è¿Ÿæ¸²æŸ“å‡å°‘CPUå‹åŠ›ï¼Œé€‚åˆå¤æ‚äº¤äº’åœºæ™¯ï¼›`renderAll()`åˆ™é€‚ç”¨äºç®€å•åœºæ™¯æˆ–å¯¹å“åº”é€Ÿåº¦è¦æ±‚æ›´é«˜çš„åœºæ™¯ã€‚


![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/42e74b3c161e4478aef36021308e26f8.gif)

### ä¼˜åŒ–å…«ã€å››è§’æ§åˆ¶ç‚¹éšæ„æ‹–æ‹½æ”¾å¤§é•¿å’Œå®½ã€æ‘’å¼ƒç­‰æ¯”æ”¾å¤§ç¼©å°ã€‘
![canvaså®ç°å›¾ç‰‡æ ‡æ³¨ä¹‹Fabric.jsä»å…¥é—¨å­¦ä¹ åˆ°å®ç°labelImgçŸ©å½¢å¤šè¾¹å½¢æ ‡æ³¨å·¥å…·](https://i-blog.csdnimg.cn/direct/284347355c224a1b952c2fbcf53eab71.gif)

```typescript

// åˆ›å»ºçŸ©å½¢æ§åˆ¶ç‚¹
function createCustomControls() {
  const commonOpts = {
    cursorStyle: "pointer", // é¼ æ ‡æ ·å¼
    withConnection: false, // æ˜¯å¦è¿æ¥
    render: renderSolidGreenCircle, // ç»˜åˆ¶åœ†å½¢
    cornerSize: 10, // æ§åˆ¶ç‚¹å¤§å°
  };

  return {
    // å·¦ä¸Šè§’ 
    tl: new Control({
      ...commonOpts,
      x: -0.5,
      y: -0.5,
      cursorStyle: "nw-resize",
      actionHandler: controlsUtils.scalingEqually,
    }),
    // å³ä¸Šè§’
    tr: new Control({
      ...commonOpts,
      x: 0.5,
      y: -0.5,
      cursorStyle: "ne-resize",
      actionHandler: controlsUtils.scalingEqually,
    }),
    // å·¦ä¸‹è§’ 
    bl: new Control({
      ...commonOpts,
      x: -0.5,
      y: 0.5,
      cursorStyle: "sw-resize",
      actionHandler: controlsUtils.scalingEqually,
    }),
    // å³ä¸‹è§’ 
    br: new Control({
      ...commonOpts,
      x: 0.5,
      y: 0.5,
      cursorStyle: "se-resize",
      actionHandler: controlsUtils.scalingEqually,
    }),

    // // å·¦è¾¹ä¸­ç‚¹ - æ¨ªå‘ç¼©æ”¾
    // ml: new Control({
    //   ...commonOpts,
    //   x: -0.5,
    //   y: 0,

    //   cursorStyle: "w-resize",
    //   actionHandler: controlsUtils.scalingX,
    // }),
    // // å³è¾¹ä¸­ç‚¹ - æ¨ªå‘ç¼©æ”¾
    // mr: new Control({
    //   ...commonOpts,
    //   x: 0.5,
    //   y: 0,
    //   cursorStyle: "e-resize",
    //   actionHandler: controlsUtils.scalingX,
    // }),
    // // ä¸Šè¾¹ä¸­ç‚¹ - çºµå‘ç¼©æ”¾
    // mt: new Control({
    //   ...commonOpts,
    //   x: 0,
    //   y: -0.5,
    //   cursorStyle: "n-resize",
    //   actionHandler: controlsUtils.scalingY,
    // }),
    // // ä¸‹è¾¹ä¸­ç‚¹ - çºµå‘ç¼©æ”¾
    // mb: new Control({
    //   ...commonOpts,
    //   x: 0,
    //   y: 0.5,
    //   cursorStyle: "s-resize",
    //   actionHandler: controlsUtils.scalingY,
    // }),

    // æ—‹è½¬æ§åˆ¶ç‚¹ï¼Œæš‚æ—¶ä¸éœ€è¦æ—‹è½¬éœ€æ±‚
    // mtr: new Control({
    //   ...commonOpts,
    //   x: 0,
    //   y: -0.7,
    //   cursorStyle: "crosshair",
    //   actionHandler: controlsUtils.rotationWithSnapping,
    //   offsetY: -10, // åˆç†è°ƒæ•´æ—‹è½¬ç‚¹è·ç¦»é¡¶éƒ¨çš„è·ç¦»
    // }),
  };
}
```

ä¼˜åŒ–ä¸­~
## END
